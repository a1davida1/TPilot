
> rest-express@1.0.0 test
> vitest run

 DEPRECATED  "environmentMatchGlobs" is deprecated. Use `test.projects` to define different configurations instead.

 RUN  v3.2.4 /home/dave/CascadeProjects/TPilot

stdout | tests/routes/saved-content.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 📡 auto-backup env with Radar: https://dotenvx.com/radar

stdout | tests/routes/saved-content.test.ts > POST /api/saved-content > creates saved content with valid payload
[dotenv@17.2.2] injecting env (21) from .env -- tip: ⚙️  write to custom object with { processEnv: myObject }

 × tests/routes/saved-content.test.ts > POST /api/saved-content > creates saved content with valid payload 871ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
 × tests/routes/saved-content.test.ts > POST /api/saved-content > rejects when referenced generation is not owned 47ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
 × tests/routes/saved-content.test.ts > POST /api/saved-content > returns 400 for invalid social media post id 35ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
stdout | tests/routes/saved-content.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

 × tests/routes/saved-content.test.ts > POST /api/saved-content > handles storage errors gracefully 44ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
stdout | tests/routes/api-registration.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 🔐 prevent building .env in docker: https://dotenvx.com/prebuild

stdout | tests/routes/api-registration.test.ts > route registration > mounts a single /api/media router chain via registerRoutes
[dotenv@17.2.2] injecting env (1) from .env -- tip: 🔐 encrypt with Dotenvx: https://dotenvx.com

 × tests/routes/api-registration.test.ts > route registration > does not register standalone /api/media routes in registerApiRoutes 30ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/storage.ts:546:104: ERROR: Expected "}" but found ")"
stdout | tests/routes/api-registration.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m
]

 × tests/routes/api-registration.test.ts > route registration > mounts a single /api/media router chain via registerRoutes 75ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
stdout | tests/unit/caption/pipeline-tone-retry.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] }

 × tests/unit/caption/pipeline-tone-retry.test.ts > Gemini pipelines keep persona tone on retry > forwards tone fields on image pipeline retry 7ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/pipeline-tone-retry.test.ts > Gemini pipelines keep persona tone on retry > returns fallback variants when Gemini emits non-JSON payloads 5ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/pipeline-tone-retry.test.ts > Gemini pipelines keep persona tone on retry > forwards tone fields on rewrite pipeline retry 24ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/pipeline-tone-retry.test.ts > Gemini pipelines keep persona tone on retry > provides fallback rewrite variants when Gemini emits plain text 7ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
stdout | tests/unit/caption/pipeline-tone-retry.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m
]

 × tests/unit/caption/pipeline-tone-retry.test.ts > Gemini pipelines keep persona tone on retry > synthesizes fallback rewrite ranking when Gemini emits plain text 8ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/pipeline-tone-retry.test.ts > Gemini pipelines keep persona tone on retry > forwards tone fields on text-only pipeline retry 28ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
stdout | tests/routes/debug-reddit-session.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/routes/debug-reddit-session.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

 × tests/routes/debug-reddit-session.test.ts > GET /api/debug/reddit-session > blocks unauthenticated access when running in production 53ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
stdout | tests/unit/caption/gemini-empty-response-guard.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 📡 auto-backup env with Radar: https://dotenvx.com/radar

stdout | tests/unit/caption/gemini-empty-response-guard.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

 × tests/unit/caption/gemini-empty-response-guard.test.ts > Gemini empty response guards > returns safe fallback variants in text-only generation when Gemini returns { label: 'an empty string', value: '' } 7ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/gemini-empty-response-guard.test.ts > Gemini empty response guards > returns safe fallback variants in text-only generation when Gemini returns { label: 'undefined', value: undefined } 6ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/gemini-empty-response-guard.test.ts > Gemini empty response guards > returns safe fallback variants in text-only generation when Gemini returns an empty payload object 7ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/gemini-empty-response-guard.test.ts > Gemini empty response guards > returns safe fallback facts when Gemini returns an empty fact payload 4ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/gemini-empty-response-guard.test.ts > Gemini empty response guards > returns safe Gemini fallbacks when image pipeline receives { label: 'an empty string', value: '' } 5ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/gemini-empty-response-guard.test.ts > Gemini empty response guards > returns safe Gemini fallbacks when image pipeline receives { label: 'undefined', value: undefined } 6ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/gemini-empty-response-guard.test.ts > Gemini empty response guards > returns Gemini variants when candidate payload is provided in text-only pipeline 6ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/gemini-empty-response-guard.test.ts > Gemini empty response guards > uses Gemini candidate payload during multimodal pipeline generation 5ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/gemini-empty-response-guard.test.ts > Gemini empty response guards > throws InvalidImageError when the remote image exceeds the configured size limit 4ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 ✓ tests/unit/caption/gemini-empty-response-guard.test.ts > Gemini model adapter resilience > resolves with empty text and retains candidates metadata when Gemini returns no candidates 2ms
 ✓ tests/unit/caption/gemini-empty-response-guard.test.ts > Gemini model adapter resilience > preserves API candidate payloads when provided 1ms
stdout | tests/routes/caption-generation.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 📡 auto-backup env with Radar: https://dotenvx.com/radar

stdout | tests/unit/auth/email-verification.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/unit/auth/email-verification.test.ts
[dotenv@17.2.2] injecting env (0) from .env -- tip: 🔐 encrypt with Dotenvx: https://dotenvx.com

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject missing token
2025-10-10T01:26:08.564Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject missing token
2025-10-10T01:26:08.633Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:08.633Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject empty token
2025-10-10T01:26:08.647Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject empty token
2025-10-10T01:26:08.650Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject empty token
2025-10-10T01:26:08.651Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:08.651Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject invalid token
2025-10-10T01:26:08.655Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject invalid token
2025-10-10T01:26:08.657Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject invalid token
2025-10-10T01:26:08.658Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:08.658Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject expired token
2025-10-10T01:26:08.661Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

 × tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject missing token 85ms
   → expected 404 to be 400 // Object.is equality
 × tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject empty token 8ms
   → expected 404 to be 400 // Object.is equality
 × tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject invalid token 7ms
   → expected 404 to be 400 // Object.is equality
stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject expired token
2025-10-10T01:26:08.664Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject expired token
2025-10-10T01:26:08.665Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:08.665Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should accept valid unexpired token
2025-10-10T01:26:08.668Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should accept valid unexpired token
2025-10-10T01:26:08.671Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should accept valid unexpired token
2025-10-10T01:26:08.672Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:08.672Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > User State Updates > should mark user as verified after successful token validation
2025-10-10T01:26:08.675Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > User State Updates > should mark user as verified after successful token validation
2025-10-10T01:26:08.678Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > User State Updates > should mark user as verified after successful token validation
2025-10-10T01:26:08.678Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:08.679Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > User State Updates > should cleanup verification token after successful verification
2025-10-10T01:26:08.683Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > User State Updates > should cleanup verification token after successful verification
2025-10-10T01:26:08.685Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > User State Updates > should cleanup verification token after successful verification
2025-10-10T01:26:08.686Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:08.686Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Edge Cases > should handle malformed tokens gracefully
2025-10-10T01:26:08.689Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Edge Cases > should handle malformed tokens gracefully
2025-10-10T01:26:08.691Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Edge Cases > should handle malformed tokens gracefully
2025-10-10T01:26:08.692Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:08.692Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Edge Cases > should handle extremely long tokens
2025-10-10T01:26:08.697Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Edge Cases > should handle extremely long tokens
2025-10-10T01:26:08.699Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Edge Cases > should handle extremely long tokens
2025-10-10T01:26:08.700Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:08.700Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Edge Cases > should handle SQL injection attempts in token
2025-10-10T01:26:08.704Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Edge Cases > should handle SQL injection attempts in token
2025-10-10T01:26:08.706Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Edge Cases > should handle SQL injection attempts in token
2025-10-10T01:26:08.707Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:08.707Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Rate Limiting Boundary Tests > should handle multiple concurrent verification requests
2025-10-10T01:26:08.709Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Rate Limiting Boundary Tests > should handle multiple concurrent verification requests
2025-10-10T01:26:08.712Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Rate Limiting Boundary Tests > should handle multiple concurrent verification requests
2025-10-10T01:26:08.713Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:08.713Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Expiration Edge Cases > should reject token that expires exactly now
2025-10-10T01:26:08.719Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Expiration Edge Cases > should reject token that expires exactly now
2025-10-10T01:26:08.721Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Expiration Edge Cases > should reject token that expires exactly now
2025-10-10T01:26:08.722Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:08.722Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Expiration Edge Cases > should accept token that expires in 1 minute
2025-10-10T01:26:08.724Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Expiration Edge Cases > should accept token that expires in 1 minute
2025-10-10T01:26:08.726Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Expiration Edge Cases > should accept token that expires in 1 minute
2025-10-10T01:26:08.727Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:08.727Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification.test.ts
2025-10-10T01:26:08.729Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Immediate'[39m
]

 × tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should reject expired token 7ms
   → expected 404 to be 400 // Object.is equality
 × tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Validation > should accept valid unexpired token 7ms
   → expected 404 to be 200 // Object.is equality
 × tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > User State Updates > should mark user as verified after successful token validation 8ms
   → expected "spy" to be called with arguments: [ 456, true ][90m

Number of calls: [1m0[22m
[39m
 × tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > User State Updates > should cleanup verification token after successful verification 5ms
   → expected "spy" to be called with arguments: [ 'cleanup-test-token' ][90m

Number of calls: [1m0[22m
[39m
 × tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Edge Cases > should handle malformed tokens gracefully 8ms
   → expected 404 to be 400 // Object.is equality
 × tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Edge Cases > should handle extremely long tokens 7ms
   → expected 404 to be 400 // Object.is equality
 × tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Edge Cases > should handle SQL injection attempts in token 5ms
   → expected 404 to be 400 // Object.is equality
 × tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Rate Limiting Boundary Tests > should handle multiple concurrent verification requests 10ms
   → expected [] to have a length of 1 but got +0
 × tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Expiration Edge Cases > should reject token that expires exactly now 6ms
   → expected 404 to be 400 // Object.is equality
 × tests/unit/auth/email-verification.test.ts > Email Verification Unit Tests > Token Expiration Edge Cases > should accept token that expires in 1 minute 5ms
   → expected 404 to be 200 // Object.is equality
stdout | tests/unit/middleware/auth.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  write to custom object with { processEnv: myObject }

stdout | tests/unit/middleware/auth.test.ts > authenticateToken email verification > rejects JWT-authenticated users with unverified email and clears auth cookie
[dotenv@17.2.2] injecting env (0) from .env -- tip: 📡 version env with Radar: https://dotenvx.com/radar

stderr | tests/unit/middleware/auth.test.ts
Error closing database connections: Error: [vitest] No "closeDatabaseConnections" export is defined on the "../../../server/db.ts" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///home/dave/CascadeProjects/TPilot/[39mnode_modules/[4mvitest[24m/dist/chunks/execute.B7h3T_Hc.js:284:17[90m)[39m
    at Object.closeDatabaseConnections [as get] [90m(file:///home/dave/CascadeProjects/TPilot/[39mnode_modules/[4mvitest[24m/dist/chunks/execute.B7h3T_Hc.js:330:16[90m)[39m
    at closeDatabaseConnections [90m(/home/dave/CascadeProjects/TPilot/[39mtests/test-utils.ts:29:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at [90m/home/dave/CascadeProjects/TPilot/[39mtests/vitest-setup.ts:92:5 {
  codeFrame: [32m'vi\x1B[33m.\x1B[39m\x1B[34mmock\x1B[39m(\x1B[35mimport\x1B[39m(\x1B[32m"../../../server/db.ts"\x1B[39m)\x1B[33m,\x1B[39m \x1B[35masync\x1B[39m (importOriginal) \x1B[33m=>\x1B[39m {\n'[39m +
    [32m'  \x1B[35mconst\x1B[39m actual \x1B[33m=\x1B[39m \x1B[35mawait\x1B[39m \x1B[34mimportOriginal\x1B[39m()\n'[39m +
    [32m'  \x1B[35mreturn\x1B[39m {\n'[39m +
    [32m'    \x1B[33m...\x1B[39mactual\x1B[33m,\x1B[39m\n'[39m +
    [32m'    \x1B[90m// your mocked methods\x1B[39m\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

stderr | tests/unit/middleware/auth.test.ts
Error during test cleanup: Error: [vitest] No "closeDatabaseConnections" export is defined on the "../../../server/db.ts" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///home/dave/CascadeProjects/TPilot/[39mnode_modules/[4mvitest[24m/dist/chunks/execute.B7h3T_Hc.js:284:17[90m)[39m
    at Object.closeDatabaseConnections [as get] [90m(file:///home/dave/CascadeProjects/TPilot/[39mnode_modules/[4mvitest[24m/dist/chunks/execute.B7h3T_Hc.js:330:16[90m)[39m
    at closeDatabaseConnections [90m(/home/dave/CascadeProjects/TPilot/[39mtests/test-utils.ts:29:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at [90m/home/dave/CascadeProjects/TPilot/[39mtests/vitest-setup.ts:92:5 {
  codeFrame: [32m'vi\x1B[33m.\x1B[39m\x1B[34mmock\x1B[39m(\x1B[35mimport\x1B[39m(\x1B[32m"../../../server/db.ts"\x1B[39m)\x1B[33m,\x1B[39m \x1B[35masync\x1B[39m (importOriginal) \x1B[33m=>\x1B[39m {\n'[39m +
    [32m'  \x1B[35mconst\x1B[39m actual \x1B[33m=\x1B[39m \x1B[35mawait\x1B[39m \x1B[34mimportOriginal\x1B[39m()\n'[39m +
    [32m'  \x1B[35mreturn\x1B[39m {\n'[39m +
    [32m'    \x1B[33m...\x1B[39mactual\x1B[33m,\x1B[39m\n'[39m +
    [32m'    \x1B[90m// your mocked methods\x1B[39m\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

 × tests/unit/middleware/auth.test.ts > authenticateToken email verification > rejects JWT-authenticated users with unverified email and clears auth cookie 35ms
   → expected "spy" to be called with arguments: [ 'authToken' ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "lax",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m

[1m  2nd spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "none",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m
[39m[90m

Number of calls: [1m2[22m
[39m
 × tests/unit/middleware/auth.test.ts > authenticateToken email verification > rejects session-authenticated users with unverified email 1ms
   → expected "spy" to be called with arguments: [ 'authToken' ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "lax",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m

[1m  2nd spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "none",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m
[39m[90m

Number of calls: [1m2[22m
[39m
 × tests/unit/middleware/auth.test.ts > authenticateToken account restrictions > rejects JWT-authenticated users whose account is deleted 2ms
   → expected "spy" to be called with arguments: [ 'authToken' ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "lax",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m

[1m  2nd spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "none",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m
[39m[90m

Number of calls: [1m2[22m
[39m
 × tests/unit/middleware/auth.test.ts > authenticateToken account restrictions > rejects JWT-authenticated users who are banned 2ms
   → expected "spy" to be called with arguments: [ 'authToken' ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "lax",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m

[1m  2nd spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "none",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m
[39m[90m

Number of calls: [1m2[22m
[39m
 × tests/unit/middleware/auth.test.ts > authenticateToken account restrictions > rejects JWT-authenticated users who are suspended 2ms
   → expected "spy" to be called with arguments: [ 'authToken' ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "lax",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m

[1m  2nd spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "none",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m
[39m[90m

Number of calls: [1m2[22m
[39m
 × tests/unit/middleware/auth.test.ts > authenticateToken account restrictions > rejects session-authenticated users whose account is deleted 1ms
   → expected "spy" to be called with arguments: [ 'authToken' ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "lax",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m

[1m  2nd spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "none",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m
[39m[90m

Number of calls: [1m2[22m
[39m
 × tests/unit/middleware/auth.test.ts > authenticateToken account restrictions > rejects session-authenticated users who are banned 1ms
   → expected "spy" to be called with arguments: [ 'authToken' ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "lax",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m

[1m  2nd spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "none",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m
[39m[90m

Number of calls: [1m2[22m
[39m
 × tests/unit/middleware/auth.test.ts > authenticateToken account restrictions > rejects session-authenticated users who are suspended 1ms
   → expected "spy" to be called with arguments: [ 'authToken' ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "lax",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m

[1m  2nd spy call:

[22m[2m  [[22m
[2m    "authToken",[22m
[31m+   {[90m
[31m+     "httpOnly": true,[90m
[31m+     "path": "/",[90m
[31m+     "sameSite": "none",[90m
[31m+     "secure": false,[90m
[31m+   },[90m
[2m  ][22m
[39m[90m

Number of calls: [1m2[22m
[39m
stdout | tests/unit/server/app-bootstrap.smoke.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/unit/server/app-bootstrap.smoke.test.ts > createExpressApp bootstrap fallback > resolves when queue prerequisites are absent
[dotenv@17.2.2] injecting env (4) from .env -- tip: ⚙️  override existing env vars with { override: true }

stdout | tests/unit/server/app-bootstrap.smoke.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m
]

 × tests/unit/server/app-bootstrap.smoke.test.ts > createExpressApp bootstrap fallback > resolves when queue prerequisites are absent 81ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
stdout | tests/unit/middleware/permissions-policy.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 📡 observe env with Radar: https://dotenvx.com/radar

stdout | tests/unit/middleware/permissions-policy.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m
]

 × tests/unit/middleware/permissions-policy.test.ts > permissionsPolicy middleware > applies a restrictive Permissions-Policy header to responses 8ms
   → expected 'geolocation=(), camera=(), microphone…' to be 'accelerometer=(), ambient-light-senso…' // Object.is equality
 ✓ tests/unit/middleware/permissions-policy.test.ts > permissionsPolicy middleware > does not overwrite an existing Permissions-Policy header 2ms
stdout | tests/unit/server/reddit-shadowban.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  override existing env vars with { override: true }

stdout | tests/unit/caption/fallback-inference.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  override existing env vars with { override: true }

stdout | tests/unit/caption/fallback-inference.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m
]

 ✓ tests/unit/caption/fallback-inference.test.ts > inferFallbackFromFacts helper > infers beach-centric fallbacks from image facts 14ms
 ✓ tests/unit/caption/fallback-inference.test.ts > inferFallbackFromFacts helper > adapts fallback data for text-only launch themes 1ms
 × tests/unit/caption/fallback-inference.test.ts > pipeline fallbacks > fills missing variant fields with contextual beach data 4ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/fallback-inference.test.ts > pipeline fallbacks > crafts launch-oriented fallbacks for text-only prompts 2ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/fallback-inference.test.ts > pipeline fallbacks > pads fallback variants without extending alt text beyond schema limits 0ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/fallback-inference.test.ts > fact extraction resilience > returns safe defaults when Gemini responds with plain text facts 0ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
stdout | tests/unit/auth/login-identifier.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 🔐 encrypt with Dotenvx: https://dotenvx.com

stdout | tests/unit/auth/email-verification-redirect.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }

(node:456135) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 uncaughtException listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
(Use `node --trace-warnings ...` to show where the warning was created)
(node:456135) MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 unhandledRejection listeners added to [process]. MaxListeners is 10. Use emitter.setMaxListeners() to increase limit
stdout | tests/unit/auth/email-verification-redirect.test.ts
[dotenv@17.2.2] injecting env (0) from .env -- tip: 📡 auto-backup env with Radar: https://dotenvx.com/radar

stdout | tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should return JSON success response on valid token with explicit Accept header
2025-10-10T01:26:09.457Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should return JSON success response on valid token with explicit Accept header
2025-10-10T01:26:09.460Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:09.460Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should redirect to frontend on valid token with browser Accept header
2025-10-10T01:26:09.462Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should redirect to frontend on valid token with browser Accept header
2025-10-10T01:26:09.465Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should redirect to frontend on valid token with browser Accept header
2025-10-10T01:26:09.466Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:09.466Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should return JSON error for invalid token with explicit Accept header
2025-10-10T01:26:09.468Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should return JSON error for invalid token with explicit Accept header
2025-10-10T01:26:09.471Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should return JSON error for invalid token with explicit Accept header
2025-10-10T01:26:09.471Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:09.472Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should redirect to error page for invalid token with browser Accept header
2025-10-10T01:26:09.474Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should redirect to error page for invalid token with browser Accept header
2025-10-10T01:26:09.476Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should redirect to error page for invalid token with browser Accept header
2025-10-10T01:26:09.477Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:09.477Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/unit/auth/email-verification-redirect.test.ts
2025-10-10T01:26:09.480Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/unit/auth/email-verification-redirect.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m,  [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m,  [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,   [32m'Timeout'[39m,
  [32m'Timeout'[39m,   [32m'Timeout'[39m,
  [32m'Timeout'[39m,   [32m'Timeout'[39m,
  [32m'Timeout'[39m,   [32m'Timeout'[39m,
  [32m'Immediate'[39m
]

 × tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should return JSON success response on valid token with explicit Accept header 5ms
   → expected 200 "OK", got 404 "Not Found"
 × tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should redirect to frontend on valid token with browser Accept header 6ms
   → expected 302 "Found", got 404 "Not Found"
 × tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should return JSON error for invalid token with explicit Accept header 6ms
   → expected 400 "Bad Request", got 404 "Not Found"
 × tests/unit/auth/email-verification-redirect.test.ts > Email Verification Redirect Tests > should redirect to error page for invalid token with browser Accept header 5ms
   → expected 302 "Found", got 404 "Not Found"
stdout | tests/unit/server/lib/gemini-client.adapter.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 📡 observe env with Radar: https://dotenvx.com/radar

stdout | tests/unit/server/lib/gemini-client.adapter.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m
]

 × tests/unit/server/lib/gemini-client.adapter.test.ts > Gemini client model adapter > flattens candidate content parts into the text helpers 10ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
stdout | tests/auth/signup.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 📡 version env with Radar: https://dotenvx.com/radar

stdout | tests/auth/signup.test.ts
[dotenv@17.2.2] injecting env (0) from .env -- tip: 📡 auto-backup env with Radar: https://dotenvx.com/radar

stdout | tests/auth/signup.test.ts > Signup and email verification > verifies email before allowing login
2025-10-10T01:26:09.790Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/auth/signup.test.ts > Signup and email verification > verifies email before allowing login
2025-10-10T01:26:09.792Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:09.792Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/auth/signup.test.ts > Signup and email verification > sets a secure auth cookie on production signup
2025-10-10T01:26:09.799Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}

stdout | tests/auth/signup.test.ts > Signup and email verification > sets a secure auth cookie on production signup
2025-10-10T01:26:09.801Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/auth/signup.test.ts > Signup and email verification > sets a secure auth cookie on production signup
2025-10-10T01:26:09.801Z [[31merror[39m] Failed to ensure admin account exists {"err":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}
2025-10-10T01:26:09.801Z [[32minfo[39m] 🔧 Applying production database fixes...

stdout | tests/auth/signup.test.ts
2025-10-10T01:26:09.804Z [[31merror[39m] ❌ Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@example.com","admin",1],"cause":{}}}

stdout | tests/auth/signup.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m,  [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m,  [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,   [32m'Timeout'[39m,
  [32m'Timeout'[39m,   [32m'Timeout'[39m,
  [32m'Timeout'[39m,   [32m'Timeout'[39m,
  [32m'Timeout'[39m,   [32m'Timeout'[39m,
  [32m'Immediate'[39m
]

 × tests/auth/signup.test.ts > Signup and email verification > verifies email before allowing login 9ms
   → expected 404 to be 201 // Object.is equality
 × tests/auth/signup.test.ts > Signup and email verification > sets a secure auth cookie on production signup 5ms
   → expected 404 to be 201 // Object.is equality
stdout | tests/unit/preview-gate.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/unit/preview-gate.test.ts
[dotenv@17.2.2] injecting env (0) from .env -- tip: 📡 auto-backup env with Radar: https://dotenvx.com/radar

stdout | tests/unit/preview-gate.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m
]

 ↓ tests/unit/preview-gate.test.ts > Preview Gate > Preview Statistics > returns correct stats with no previews
 ↓ tests/unit/preview-gate.test.ts > Preview Gate > Preview Statistics > counts OK previews in last 14 days
 ↓ tests/unit/preview-gate.test.ts > Preview Gate > Preview Statistics > enables queue when requirement is met
 ↓ tests/unit/preview-gate.test.ts > Preview Gate > Queue Permission > denies queue with insufficient previews
 ↓ tests/unit/preview-gate.test.ts > Preview Gate > Queue Permission > allows queue with sufficient previews
 ↓ tests/unit/preview-gate.test.ts > Preview Gate > Gate Check > provides detailed gate check result when requirement not met
 ↓ tests/unit/preview-gate.test.ts > Preview Gate > Gate Check > passes gate check when requirement is met
 ↓ tests/unit/preview-gate.test.ts > Preview Gate > Error Handling > handles database errors gracefully
stdout | tests/unit/server/services/redditIntelligenceService.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 🔐 prevent building .env in docker: https://dotenvx.com/prebuild

stdout | tests/unit/server/services/redditIntelligenceService.test.ts
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  write to custom object with { processEnv: myObject }

stdout | tests/unit/server/services/redditIntelligenceService.test.ts > RedditIntelligenceService > builds intelligence dataset and caches subsequent calls
2025-10-10T01:26:10.137Z [warn] Failed to get user communities {"userId":42,"error":{"query":"select \"handle\" from \"creator_accounts\" where (\"creator_accounts\".\"user_id\" = $1 and \"creator_accounts\".\"platform\" = $2) limit $3","params":[42,"reddit",1],"cause":{}}}

stdout | tests/unit/server/services/redditIntelligenceService.test.ts > RedditIntelligenceService > builds intelligence dataset and caches subsequent calls
2025-10-10T01:26:10.139Z [warn] Failed to get post outcome metrics (table may not exist yet) {"error":{"query":"select \"subreddit\", \"status\", count(*)::int from \"reddit_post_outcomes\" where \"reddit_post_outcomes\".\"occurred_at\" >= $1 group by \"reddit_post_outcomes\".\"subreddit\", \"reddit_post_outcomes\".\"status\"","params":["2025-09-10T01:26:10.137Z"],"cause":{}}}

stdout | tests/unit/server/services/redditIntelligenceService.test.ts > RedditIntelligenceService > provides fallback topics when Reddit data is unavailable
2025-10-10T01:26:10.141Z [warn] Failed to collect Reddit listings {"subreddit":"popular","type":"hot","error":{}}

stdout | tests/unit/server/services/redditIntelligenceService.test.ts > RedditIntelligenceService > provides fallback topics when Reddit data is unavailable
2025-10-10T01:26:10.142Z [warn] Failed to get post outcome metrics (table may not exist yet) {"error":{"query":"select \"subreddit\", \"status\", count(*)::int from \"reddit_post_outcomes\" where \"reddit_post_outcomes\".\"occurred_at\" >= $1 group by \"reddit_post_outcomes\".\"subreddit\", \"reddit_post_outcomes\".\"status\"","params":["2025-09-10T01:26:10.141Z"],"cause":{}}}

stdout | tests/unit/server/services/redditIntelligenceService.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m
]

 × tests/unit/server/services/redditIntelligenceService.test.ts > RedditIntelligenceService > builds intelligence dataset and caches subsequent calls 5ms
   → expected "spy" to be called 2 times, but got 5 times
 ✓ tests/unit/server/services/redditIntelligenceService.test.ts > RedditIntelligenceService > provides fallback topics when Reddit data is unavailable 2ms
stdout | tests/unit/server/reddit-safety-validation.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/unit/server/reddit-safety-validation.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m
]

 × tests/unit/server/reddit-safety-validation.test.ts > Reddit Safety Validation and Rule Checks > Safety Integration Tests > should validate SafetyManager has correct API methods 23ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
 × tests/unit/server/reddit-safety-validation.test.ts > Reddit Safety Validation and Rule Checks > Safety Integration Tests > should validate RedditManager has correct method signatures 4ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/reddit.ts:812:71: ERROR: Expected "}" but found ")"
 × tests/unit/server/reddit-safety-validation.test.ts > Reddit Safety Validation and Rule Checks > Safety Integration Tests > should handle SafetyCheckResult structure correctly 1ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
 × tests/unit/server/reddit-safety-validation.test.ts > Reddit Safety Validation and Rule Checks > Safety Integration Tests > should validate integration patterns work correctly 0ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
 ✓ tests/unit/server/reddit-safety-validation.test.ts > Reddit Safety Validation and Rule Checks > Method Signature Validation > should validate recordSafetySignals integration is properly named 0ms
 × tests/unit/server/reddit-safety-validation.test.ts > Reddit Safety Validation and Rule Checks > Method Signature Validation > should validate config utilities are accessible 0ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
stdout | tests/unit/server/reddit-manager.can-post.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 📡 auto-backup env with Radar: https://dotenvx.com/radar

stdout | tests/routes/metrics.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  override existing env vars with { override: true }

stdout | tests/routes/metrics.test.ts
[dotenv@17.2.2] injecting env (0) from .env -- tip: 🔐 encrypt with Dotenvx: https://dotenvx.com

stdout | tests/routes/webhooks.stripe.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  override existing env vars with { override: true }

stdout | tests/routes/webhooks.stripe.test.ts
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/routes/webhooks.stripe.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

 ↓ tests/routes/webhooks.stripe.test.ts > Stripe webhook integration > processes subscription and invoice webhooks through the prefixed endpoint
stdout | tests/unit/payment-providers.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  suppress all logs with { quiet: true }

stdout | tests/unit/payment-providers.test.ts
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/unit/payment-providers.test.ts > Payment Providers > Coinbase Provider > handles API errors properly
2025-10-10T01:26:10.641Z [[31merror[39m] Coinbase Commerce checkout creation failed: {"error":"Failed to create Coinbase Commerce checkout session"}
Error: Failed to create Coinbase Commerce checkout session
    at Object.createCheckout (/home/dave/CascadeProjects/TPilot/server/payments/payment-providers.ts:108:17)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)

stdout | tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Network Errors and API Failures > handles network timeout for Coinbase
2025-10-10T01:26:10.744Z [[31merror[39m] Coinbase Commerce checkout creation failed: {"error":"Network timeout"}
Error: Network timeout
    at global.fetch (/home/dave/CascadeProjects/TPilot/tests/unit/payment-providers.test.ts:258:17)
    at Object.createCheckout (/home/dave/CascadeProjects/TPilot/server/payments/payment-providers.ts:83:26)
    at /home/dave/CascadeProjects/TPilot/tests/unit/payment-providers.test.ts:262:9
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Paxum Provider > creates checkout URL with valid API key 1ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Paxum Provider > uses default return URL when none provided 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Paxum Provider > returns disabled provider when API key missing 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Paxum Provider > throws error when disabled provider used 1ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Paxum Provider > handles zero amount correctly 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Coinbase Provider > creates checkout with valid API key 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Coinbase Provider > handles API errors properly 1ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Coinbase Provider > returns disabled provider when API key missing 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Coinbase Provider > throws error when disabled provider used 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Coinbase Provider > formats amount correctly for API 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Malformed Data > handles extremely large amounts gracefully 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Malformed Data > handles negative amounts by converting to zero 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Malformed Data > handles special characters in user ID and plan ID 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Malformed Data > handles missing or invalid base URL 0ms
stdout | tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Network Errors and API Failures > handles malformed JSON response from Coinbase
2025-10-10T01:26:10.745Z [[31merror[39m] Coinbase Commerce checkout creation failed: {"error":"Unexpected end of JSON input"}
Error: Unexpected end of JSON input
    at Object.json (/home/dave/CascadeProjects/TPilot/tests/unit/payment-providers.test.ts:278:19)
    at Object.createCheckout (/home/dave/CascadeProjects/TPilot/server/payments/payment-providers.ts:113:37)

stdout | tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Network Errors and API Failures > handles missing hosted_url in Coinbase response
2025-10-10T01:26:10.746Z [[31merror[39m] Coinbase Commerce checkout creation failed: {"error":"Invalid response from Coinbase Commerce API"}
Error: Invalid response from Coinbase Commerce API
    at Object.createCheckout (/home/dave/CascadeProjects/TPilot/server/payments/payment-providers.ts:117:17)
    at /home/dave/CascadeProjects/TPilot/tests/unit/payment-providers.test.ts:308:9
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20

stdout | tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Network Errors and API Failures > handles rate limiting responses
2025-10-10T01:26:10.746Z [[31merror[39m] Coinbase Commerce checkout creation failed: {"error":"Failed to create Coinbase Commerce checkout session"}
Error: Failed to create Coinbase Commerce checkout session
    at Object.createCheckout (/home/dave/CascadeProjects/TPilot/server/payments/payment-providers.ts:108:17)

stderr | tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Input Validation > validates required fields for Paxum
Promise returned by `expect(actual).rejects.toThrow()` was not awaited. Vitest currently auto-awaits hanging assertions at the end of the test, but this will cause the test to fail in Vitest 3. Please remember to await the assertion.
    at /home/dave/CascadeProjects/TPilot/tests/unit/payment-providers.test.ts:354:49

stderr | tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Input Validation > validates required fields for Paxum
Promise returned by `expect(actual).rejects.toThrow()` was not awaited. Vitest currently auto-awaits hanging assertions at the end of the test, but this will cause the test to fail in Vitest 3. Please remember to await the assertion.
    at /home/dave/CascadeProjects/TPilot/tests/unit/payment-providers.test.ts:348:49

stdout | tests/unit/payment-providers.test.ts > Payment Providers > Provider Array Export > filters out disabled providers
[dotenv@17.2.2] injecting env (1) from .env -- tip: 🔐 encrypt with Dotenvx: https://dotenvx.com

stdout | tests/unit/payment-providers.test.ts > Payment Providers > Provider Array Export > includes enabled providers
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  override existing env vars with { override: true }

stdout | tests/unit/payment-providers.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Network Errors and API Failures > handles network timeout for Coinbase 102ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Network Errors and API Failures > handles malformed JSON response from Coinbase 1ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Network Errors and API Failures > handles missing hosted_url in Coinbase response 1ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Network Errors and API Failures > handles rate limiting responses 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Input Validation > validates required fields for Paxum 1ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Edge Cases and Error Handling > Input Validation > validates amount ranges for Coinbase 1ms
 × tests/unit/payment-providers.test.ts > Payment Providers > Provider Array Export > filters out disabled providers 12ms
   → expected [ { name: 'stripe', …(2) } ] to have a length of +0 but got 1
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Provider Array Export > includes enabled providers 9ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Stripe Provider > creates checkout URL with valid secret key 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Stripe Provider > uses default return URL when none provided 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Stripe Provider > returns disabled provider when secret key missing 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Stripe Provider > throws error when disabled provider used 0ms
 ✓ tests/unit/payment-providers.test.ts > Payment Providers > Stripe Provider > validates required parameters 0ms
stdout | server/compliance/__tests__/ruleViolationTracker.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  suppress all logs with { quiet: true }

stdout | server/compliance/__tests__/ruleViolationTracker.test.ts > ruleViolationTracker > records successful posts without inflating removal counts
[dotenv@17.2.2] injecting env (0) from .env -- tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit

stdout | server/compliance/__tests__/ruleViolationTracker.test.ts > ruleViolationTracker > aggregates removal reasons for a user
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | server/compliance/__tests__/ruleViolationTracker.test.ts > ruleViolationTracker > handles empty state by returning zero counts
[dotenv@17.2.2] injecting env (0) from .env -- tip: 📡 auto-backup env with Radar: https://dotenvx.com/radar

stdout | server/compliance/__tests__/ruleViolationTracker.test.ts > ruleViolationTracker > defaults missing removal reasons to unspecified bucket
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }

 ✓ server/compliance/__tests__/ruleViolationTracker.test.ts > ruleViolationTracker > records successful posts without inflating removal counts 15ms
 ✓ server/compliance/__tests__/ruleViolationTracker.test.ts > ruleViolationTracker > aggregates removal reasons for a user 12ms
 ✓ server/compliance/__tests__/ruleViolationTracker.test.ts > ruleViolationTracker > handles empty state by returning zero counts 7ms
stdout | server/compliance/__tests__/ruleViolationTracker.test.ts > ruleViolationTracker > persists recorded outcomes across module reloads
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  enable debug logging with { debug: true }

stdout | server/compliance/__tests__/ruleViolationTracker.test.ts > ruleViolationTracker > persists recorded outcomes across module reloads
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  enable debug logging with { debug: true }

stdout | server/compliance/__tests__/ruleViolationTracker.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

 ✓ server/compliance/__tests__/ruleViolationTracker.test.ts > ruleViolationTracker > defaults missing removal reasons to unspecified bucket 9ms
 ✓ server/compliance/__tests__/ruleViolationTracker.test.ts > ruleViolationTracker > persists recorded outcomes across module reloads 19ms
stdout | tests/unit/caption/voice-guide-prompt.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/unit/caption/voice-guide-prompt.test.ts
[dotenv@17.2.2] injecting env (0) from .env -- tip: 📡 auto-backup env with Radar: https://dotenvx.com/radar

stdout | tests/unit/caption/voice-guide-prompt.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

 × tests/unit/caption/voice-guide-prompt.test.ts > Voice guide prompt forwarding > includes the voice guide when generating image-based variants 4ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/voice-guide-prompt.test.ts > Voice guide prompt forwarding > includes the voice guide for text-only variant generation 7ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 × tests/unit/caption/voice-guide-prompt.test.ts > Voice guide prompt forwarding > includes the voice guide when rewriting captions 6ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
stdout | tests/unit/server/services/multi-ai-provider.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 📡 observe env with Radar: https://dotenvx.com/radar

stdout | tests/unit/server/services/multi-ai-provider.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

 × tests/unit/server/services/multi-ai-provider.test.ts > generateWithMultiProvider provider selection > prefers Gemini when a Gemini key is available 23ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
 × tests/unit/server/services/multi-ai-provider.test.ts > generateWithMultiProvider provider selection > uses Gemini model names directly from env without normalization 9ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
 × tests/unit/server/services/multi-ai-provider.test.ts > generateWithMultiProvider provider selection > falls back to Claude before OpenAI when Gemini is unavailable 9ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
 × tests/unit/server/services/multi-ai-provider.test.ts > generateWithMultiProvider provider selection > falls back to OpenAI after Claude when Claude fails 7ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
stdout | tests/unit/caption/nsfw-fallback.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/unit/caption/nsfw-fallback.test.ts > nsfwCaptionFallback > propagates NSFW flag through OpenAI fallback variants
[dotenv@17.2.2] injecting env (0) from .env -- tip: 📡 observe env with Radar: https://dotenvx.com/radar

stdout | tests/unit/caption/nsfw-fallback.test.ts > nsfwCaptionFallback > throws after exhausting caption retries
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":93918384,"external":4052591,"arrayBuffers":383571}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.44},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.44},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":383571,"external":4052591,"heapTotal":176664576,"heapUsed":93918384,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94110560,"external":4060847,"arrayBuffers":391787}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.44},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.44},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":391787,"external":4060847,"heapTotal":176664576,"heapUsed":94110560,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94145152,"external":4060847,"arrayBuffers":391787}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.44},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.44},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":391787,"external":4060847,"heapTotal":176664576,"heapUsed":94145152,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94180056,"external":4069039,"arrayBuffers":399979}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.44},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.44},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":399979,"external":4069039,"heapTotal":176664576,"heapUsed":94180056,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94214768,"external":4077231,"arrayBuffers":408171}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.44},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.44},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":408171,"external":4077231,"heapTotal":176664576,"heapUsed":94214768,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94248952,"external":4077231,"arrayBuffers":408171}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":408171,"external":4077231,"heapTotal":176664576,"heapUsed":94248952,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94368992,"external":4093615,"arrayBuffers":424555}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":424555,"external":4093615,"heapTotal":176664576,"heapUsed":94368992,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94403440,"external":4101807,"arrayBuffers":432747}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":432747,"external":4101807,"heapTotal":176664576,"heapUsed":94403440,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94437880,"external":4109999,"arrayBuffers":440939}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":440939,"external":4109999,"heapTotal":176664576,"heapUsed":94437880,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94571200,"external":4126383,"arrayBuffers":457323}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":457323,"external":4126383,"heapTotal":176664576,"heapUsed":94571200,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94605752,"external":4134575,"arrayBuffers":465515}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":465515,"external":4134575,"heapTotal":176664576,"heapUsed":94605752,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94641832,"external":4134575,"arrayBuffers":465515}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":465515,"external":4134575,"heapTotal":176664576,"heapUsed":94641832,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94676472,"external":4142767,"arrayBuffers":473707}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":473707,"external":4142767,"heapTotal":176664576,"heapUsed":94676472,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94711112,"external":4150959,"arrayBuffers":481899}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":481899,"external":4150959,"heapTotal":176664576,"heapUsed":94711112,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94745464,"external":4150959,"arrayBuffers":481899}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":481899,"external":4150959,"heapTotal":176664576,"heapUsed":94745464,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94779912,"external":4159151,"arrayBuffers":490091}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":490091,"external":4159151,"heapTotal":176664576,"heapUsed":94779912,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94814552,"external":4167343,"arrayBuffers":498283}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":498283,"external":4167343,"heapTotal":176664576,"heapUsed":94814552,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94849016,"external":4167343,"arrayBuffers":498283}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":498283,"external":4167343,"heapTotal":176664576,"heapUsed":94849016,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94883704,"external":4175535,"arrayBuffers":506475}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":506475,"external":4175535,"heapTotal":176664576,"heapUsed":94883704,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94918600,"external":4183727,"arrayBuffers":514667}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":514667,"external":4183727,"heapTotal":176664576,"heapUsed":94918600,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94952872,"external":4183727,"arrayBuffers":514667}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":514667,"external":4183727,"heapTotal":176664576,"heapUsed":94952872,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":94987320,"external":4191919,"arrayBuffers":522859}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":522859,"external":4191919,"heapTotal":176664576,"heapUsed":94987320,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":95025624,"external":4200111,"arrayBuffers":531051}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":531051,"external":4200111,"heapTotal":176664576,"heapUsed":95025624,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":95059896,"external":4200111,"arrayBuffers":531051}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":531051,"external":4200111,"heapTotal":176664576,"heapUsed":95059896,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":95094344,"external":4208303,"arrayBuffers":539243}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":539243,"external":4208303,"heapTotal":176664576,"heapUsed":95094344,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":95128840,"external":4216495,"arrayBuffers":547435}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":547435,"external":4216495,"heapTotal":176664576,"heapUsed":95128840,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":95163112,"external":4216495,"arrayBuffers":547435}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":547435,"external":4216495,"heapTotal":176664576,"heapUsed":95163112,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":95197584,"external":4224687,"arrayBuffers":555627}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":555627,"external":4224687,"heapTotal":176664576,"heapUsed":95197584,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":95232080,"external":4232879,"arrayBuffers":563819}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":563819,"external":4232879,"heapTotal":176664576,"heapUsed":95232080,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":95266352,"external":4232879,"arrayBuffers":563819}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":563819,"external":4232879,"heapTotal":176664576,"heapUsed":95266352,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
2025-10-10T01:26:12.136Z [[31merror[39m] unhandledRejection: caption request failed
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19) {"error":{},"rejection":true,"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","process":{"pid":456135,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"memoryUsage":{"rss":257179648,"heapTotal":176664576,"heapUsed":95300800,"external":4241071,"arrayBuffers":572011}},"os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}
Error: caption request failed
    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13
    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)
    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)
    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)
{"date":"Thu Oct 09 2025 20:26:12 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: caption request failed\nError: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","os":{"loadavg":[3.13,2.08,1.65],"uptime":136893.45},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/node_modules/tinypool/dist/entry/process.js"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":572011,"external":4241071,"heapTotal":176664576,"heapUsed":95300800,"rss":257179648},"pid":456135,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"Error: caption request failed\n    at /home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:99:13\n    at retryWithBackoff (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:27:14)\n    at captionImage (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:89:15)\n    at Module.nsfwCaptionFallback (/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts:120:19)","timestamp":"2025-10-10T01:26:12.136Z","trace":[{"column":13,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":null,"line":99,"method":null,"native":false},{"column":14,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"retryWithBackoff","line":27,"method":null,"native":false},{"column":15,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"captionImage","line":89,"method":null,"native":false},{"column":19,"file":"/home/dave/CascadeProjects/TPilot/server/caption/nsfwFallback.ts","function":"Module.nsfwCaptionFallback","line":120,"method":"nsfwCaptionFallback","native":false}]}

 ✓ tests/unit/caption/nsfw-fallback.test.ts > nsfwCaptionFallback > returns caption tagged as NSFW 2ms
 ✓ tests/unit/caption/nsfw-fallback.test.ts > nsfwCaptionFallback > treats image as SFW when detection API exhausts retries with 500 errors 3ms
 ✓ tests/unit/caption/nsfw-fallback.test.ts > nsfwCaptionFallback > treats image as SFW when detection API exhausts retries with 429 errors 2ms
 × tests/unit/caption/nsfw-fallback.test.ts > nsfwCaptionFallback > propagates NSFW flag through OpenAI fallback variants 77ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/lib/images.ts:78:121: ERROR: Expected ")" but found ";"
 × tests/unit/caption/nsfw-fallback.test.ts > nsfwCaptionFallback > ensures pipeline fallback preserves NSFW metadata and labeling 5ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/caption/geminiPipeline.ts:1080:85: ERROR: Expected "}" but found ")"
 ✓ tests/unit/caption/nsfw-fallback.test.ts > nsfwCaptionFallback > retries NSFW detection on transient failures 1ms
 ✓ tests/unit/caption/nsfw-fallback.test.ts > nsfwCaptionFallback > retries caption generation before succeeding 1ms
(node:456135) PromiseRejectionHandledWarning: Promise rejection was handled asynchronously (rejection id: 15)
stdout | tests/unit/caption/nsfw-fallback.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

 ✓ tests/unit/caption/nsfw-fallback.test.ts > nsfwCaptionFallback > throws after exhausting caption retries 18ms
stdout | tests/unit/storage/saved-content.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 📡 observe env with Radar: https://dotenvx.com/radar

stderr | tests/unit/storage/saved-content.test.ts
Error closing database connections: Error: [vitest] No "closeDatabaseConnections" export is defined on the "../../../server/db.ts" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///home/dave/CascadeProjects/TPilot/[39mnode_modules/[4mvitest[24m/dist/chunks/execute.B7h3T_Hc.js:284:17[90m)[39m
    at Object.closeDatabaseConnections [as get] [90m(file:///home/dave/CascadeProjects/TPilot/[39mnode_modules/[4mvitest[24m/dist/chunks/execute.B7h3T_Hc.js:330:16[90m)[39m
    at closeDatabaseConnections [90m(/home/dave/CascadeProjects/TPilot/[39mtests/test-utils.ts:29:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at [90m/home/dave/CascadeProjects/TPilot/[39mtests/vitest-setup.ts:92:5 {
  codeFrame: [32m'vi\x1B[33m.\x1B[39m\x1B[34mmock\x1B[39m(\x1B[35mimport\x1B[39m(\x1B[32m"../../../server/db.ts"\x1B[39m)\x1B[33m,\x1B[39m \x1B[35masync\x1B[39m (importOriginal) \x1B[33m=>\x1B[39m {\n'[39m +
    [32m'  \x1B[35mconst\x1B[39m actual \x1B[33m=\x1B[39m \x1B[35mawait\x1B[39m \x1B[34mimportOriginal\x1B[39m()\n'[39m +
    [32m'  \x1B[35mreturn\x1B[39m {\n'[39m +
    [32m'    \x1B[33m...\x1B[39mactual\x1B[33m,\x1B[39m\n'[39m +
    [32m'    \x1B[90m// your mocked methods\x1B[39m\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

stderr | tests/unit/storage/saved-content.test.ts
Error during test cleanup: Error: [vitest] No "closeDatabaseConnections" export is defined on the "../../../server/db.ts" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///home/dave/CascadeProjects/TPilot/[39mnode_modules/[4mvitest[24m/dist/chunks/execute.B7h3T_Hc.js:284:17[90m)[39m
    at Object.closeDatabaseConnections [as get] [90m(file:///home/dave/CascadeProjects/TPilot/[39mnode_modules/[4mvitest[24m/dist/chunks/execute.B7h3T_Hc.js:330:16[90m)[39m
    at closeDatabaseConnections [90m(/home/dave/CascadeProjects/TPilot/[39mtests/test-utils.ts:29:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at [90m/home/dave/CascadeProjects/TPilot/[39mtests/vitest-setup.ts:92:5 {
  codeFrame: [32m'vi\x1B[33m.\x1B[39m\x1B[34mmock\x1B[39m(\x1B[35mimport\x1B[39m(\x1B[32m"../../../server/db.ts"\x1B[39m)\x1B[33m,\x1B[39m \x1B[35masync\x1B[39m (importOriginal) \x1B[33m=>\x1B[39m {\n'[39m +
    [32m'  \x1B[35mconst\x1B[39m actual \x1B[33m=\x1B[39m \x1B[35mawait\x1B[39m \x1B[34mimportOriginal\x1B[39m()\n'[39m +
    [32m'  \x1B[35mreturn\x1B[39m {\n'[39m +
    [32m'    \x1B[33m...\x1B[39mactual\x1B[33m,\x1B[39m\n'[39m +
    [32m'    \x1B[90m// your mocked methods\x1B[39m\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

 × tests/unit/storage/saved-content.test.ts > DatabaseStorage saved content operations > creates saved content successfully 3ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/storage.ts:546:104: ERROR: Expected "}" but found ")"
 × tests/unit/storage/saved-content.test.ts > DatabaseStorage saved content operations > logs and rethrows when createSavedContent fails 3ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/storage.ts:546:104: ERROR: Expected "}" but found ")"
 × tests/unit/storage/saved-content.test.ts > DatabaseStorage saved content operations > retrieves saved content by id when owned by user 3ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/storage.ts:546:104: ERROR: Expected "}" but found ")"
 × tests/unit/storage/saved-content.test.ts > DatabaseStorage saved content operations > returns undefined and logs when getSavedContentById throws 3ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/storage.ts:546:104: ERROR: Expected "}" but found ")"
 × tests/unit/storage/saved-content.test.ts > DatabaseStorage saved content operations > returns user saved content list 3ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/storage.ts:546:104: ERROR: Expected "}" but found ")"
 × tests/unit/storage/saved-content.test.ts > DatabaseStorage saved content operations > returns empty array and logs when getUserSavedContent fails 2ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/storage.ts:546:104: ERROR: Expected "}" but found ")"
 × tests/unit/storage/saved-content.test.ts > DatabaseStorage saved content operations > deletes saved content for user 3ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/storage.ts:546:104: ERROR: Expected "}" but found ")"
 × tests/unit/storage/saved-content.test.ts > DatabaseStorage saved content operations > logs and rethrows when deleteSavedContent fails 2ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/storage.ts:546:104: ERROR: Expected "}" but found ")"
stdout | tests/routes/admin-communities.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/routes/admin-communities.test.ts
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  suppress all logs with { quiet: true }

stdout | tests/routes/admin-communities.test.ts > Admin Communities Routes > GET /api/admin/communities > should handle list communities error
2025-10-10T01:26:11.757Z [[31merror[39m] Failed to list communities: {"error":"Database error"}
Error: Database error
    at /home/dave/CascadeProjects/TPilot/tests/routes/admin-communities.test.ts:158:45
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at runSuite (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > GET /api/admin/communities > should list all communities 5ms
stdout | tests/routes/admin-communities.test.ts > Admin Communities Routes > PUT /api/admin/communities/:id > should return 400 when validation fails during update
2025-10-10T01:26:11.765Z [[31merror[39m] Failed to update community: {"error":"[\n  {\n    \"code\": \"custom\",\n    \"path\": [\n      \"displayName\"\n    ],\n    \"message\": \"Display name is required\"\n  }\n]"}
ZodError: [
  {
    "code": "custom",
    "path": [
      "displayName"
    ],
    "message": "Display name is required"
  }
]
    at /home/dave/CascadeProjects/TPilot/tests/routes/admin-communities.test.ts:287:31
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at runSuite (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

stdout | tests/routes/admin-communities.test.ts > Admin Communities Routes > PUT /api/admin/communities/:id > should return 500 when update community fails unexpectedly
2025-10-10T01:26:11.769Z [[31merror[39m] Failed to update community: {"error":"Unexpected failure"}
Error: Unexpected failure
    at /home/dave/CascadeProjects/TPilot/tests/routes/admin-communities.test.ts:326:45
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at runSuite (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

stdout | tests/routes/admin-communities.test.ts > Admin Communities Routes > DELETE /api/admin/communities/:id > should handle delete community error
2025-10-10T01:26:11.776Z [[31merror[39m] Failed to delete community: {"error":"Database error"}
Error: Database error
    at /home/dave/CascadeProjects/TPilot/tests/routes/admin-communities.test.ts:371:45
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at runSuite (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

stdout | tests/routes/admin-communities.test.ts > Admin Communities Routes > Input Validation and Error Handling > should return 400 for invalid community data on creation
2025-10-10T01:26:11.784Z [[31merror[39m] Failed to create community: {"error":"Validation failed: name is required"}
Error: Validation failed: name is required
    at /home/dave/CascadeProjects/TPilot/tests/routes/admin-communities.test.ts:444:45
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at runSuite (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

stdout | tests/routes/admin-communities.test.ts > Admin Communities Routes > Input Validation and Error Handling > should return 400 for invalid enum values
2025-10-10T01:26:11.786Z [[31merror[39m] Failed to create community: {"error":"Invalid enum values: promotionAllowed must be one of [yes, no, limited, subtle, strict, unknown]"}
Error: Invalid enum values: promotionAllowed must be one of [yes, no, limited, subtle, strict, unknown]
    at /home/dave/CascadeProjects/TPilot/tests/routes/admin-communities.test.ts:469:9
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:155:11
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:752:26
    at file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1863:10)
    at runTest (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1574:12)
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at runSuite (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)
    at runSuite (file:///home/dave/CascadeProjects/TPilot/node_modules/@vitest/runner/dist/chunk-hooks.js:1729:8)

stdout | tests/routes/admin-communities.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > GET /api/admin/communities > should handle list communities error 5ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > POST /api/admin/communities > should create a new community 3ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > PUT /api/admin/communities/:id > should update an existing community 2ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > PUT /api/admin/communities/:id > should return 400 when validation fails during update 3ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > PUT /api/admin/communities/:id > should handle update community not found 2ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > PUT /api/admin/communities/:id > should return 500 when update community fails unexpectedly 2ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > DELETE /api/admin/communities/:id > should delete a community 2ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > DELETE /api/admin/communities/:id > should return 404 when deleting non-existent community 3ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > DELETE /api/admin/communities/:id > should handle delete community error 2ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > Authentication and Authorization > should return 401 when no authentication token is provided 2ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > Authentication and Authorization > should return 403 when user is not admin 2ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > Authentication and Authorization > should allow access for authenticated admin user 2ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > Input Validation and Error Handling > should return 400 for invalid community data on creation 2ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > Input Validation and Error Handling > should return 400 for invalid enum values 2ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > Enum Variations and Response Shaping > should handle all canonical selling policy enum variations 2ms
 ✓ tests/routes/admin-communities.test.ts > Admin Communities Routes > Enum Variations and Response Shaping > should properly shape response to match AdminCommunity interface 2ms
stdout | tests/unit/admin-routes.setup.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/unit/admin-routes.setup.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

 × tests/unit/admin-routes.setup.test.ts > setupAdminRoutes environment configuration > initialises without JWT secret in test environment 21ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/storage.ts:546:104: ERROR: Expected "}" but found ")"
 × tests/unit/admin-routes.setup.test.ts > setupAdminRoutes environment configuration > rejects admin requests when JWT secret missing in production 4ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/storage.ts:546:104: ERROR: Expected "}" but found ")"
stdout | tests/unit/email-service.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/unit/email-service.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

 ✓ tests/unit/email-service.test.ts > Email Service - SendGrid Integration > Configuration > should configure SendGrid when API key provided 10ms
 ✓ tests/unit/email-service.test.ts > Email Service - SendGrid Integration > Configuration > should handle missing API key gracefully 1ms
 ✓ tests/unit/email-service.test.ts > Email Service - SendGrid Integration > Email Sending > should send verification email successfully 2ms
 ✓ tests/unit/email-service.test.ts > Email Service - SendGrid Integration > Email Sending > should send password reset email successfully 1ms
 ✓ tests/unit/email-service.test.ts > Email Service - SendGrid Integration > Email Sending > should send welcome email successfully 1ms
 ✓ tests/unit/email-service.test.ts > Email Service - SendGrid Integration > Error Handling > should handle SendGrid API errors 2ms
 ✓ tests/unit/email-service.test.ts > Email Service - SendGrid Integration > Error Handling > should skip emails when SendGrid not configured 1ms
 ✓ tests/unit/email-service.test.ts > Email Service - SendGrid Integration > Error Handling > should handle missing JWT_SECRET for password reset 1ms
 ✓ tests/unit/email-service.test.ts > Email Service - SendGrid Integration > Error Handling > should not throw for welcome email failures 1ms
 ✓ tests/unit/email-service.test.ts > Email Service - SendGrid Integration > Environment Variable Requirements > should document required environment variables 0ms
stdout | tests/unit/lib/openrouter-client.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  override existing env vars with { override: true }

stdout | tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > initializes with correct baseURL and headers
[dotenv@17.2.2] injecting env (1) from .env -- tip: 🔐 encrypt with Dotenvx: https://dotenvx.com

stdout | tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > initializes with correct baseURL and headers
2025-10-10T01:26:12.213Z [[32minfo[39m] [OpenRouter] Default model: x-ai/grok-4-fast

stdout | tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > uses default model opengvlab/internvl3-78b
[dotenv@17.2.2] injecting env (1) from .env -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > uses default model opengvlab/internvl3-78b
2025-10-10T01:26:12.222Z [[32minfo[39m] [OpenRouter] Default model: x-ai/grok-4-fast

stdout | tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > includes image_url in vision payload
[dotenv@17.2.2] injecting env (1) from .env -- tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > includes image_url in vision payload
2025-10-10T01:26:12.232Z [[32minfo[39m] [OpenRouter] Default model: x-ai/grok-4-fast

stdout | tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > applies custom temperature and penalties
[dotenv@17.2.2] injecting env (1) from .env -- tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > applies custom temperature and penalties
2025-10-10T01:26:12.245Z [[32minfo[39m] [OpenRouter] Default model: x-ai/grok-4-fast

 ✓ tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > initializes with correct baseURL and headers 12ms
 × tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > uses default model opengvlab/internvl3-78b 10ms
   → expected "spy" to be called with arguments: [ ObjectContaining{…} ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[32m-   ObjectContaining {[90m
[32m-     "model": "opengvlab/internvl3-78b",[90m
[31m+   {[90m
[31m+     "frequency_penalty": 0.7,[90m
[31m+     "messages": [[90m
[31m+       {[90m
[31m+         "content": [[90m
[31m+           {[90m
[31m+             "text": "test",[90m
[31m+             "type": "text",[90m
[31m+           },[90m
[31m+           {[90m
[31m+             "image_url": {[90m
[31m+               "url": "data:image/png;base64,abc123",[90m
[31m+             },[90m
[31m+             "type": "image_url",[90m
[31m+           },[90m
[31m+         ],[90m
[31m+         "role": "user",[90m
[31m+       },[90m
[31m+     ],[90m
[31m+     "model": "x-ai/grok-4-fast",[90m
[31m+     "presence_penalty": 1.5,[90m
[31m+     "provider": {[90m
[31m+       "allow_fallbacks": true,[90m
[31m+       "data_collection": "deny",[90m
[31m+       "require_parameters": true,[90m
[31m+     },[90m
[31m+     "temperature": 0.2,[90m
[2m    },[22m
[2m  ][22m
[39m[90m

Number of calls: [1m1[22m
[39m
 ✓ tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > includes image_url in vision payload 9ms
stdout | tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > throws error when API key is missing
[dotenv@17.2.2] injecting env (2) from .env -- tip: 📡 auto-backup env with Radar: https://dotenvx.com/radar

stdout | tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > throws error when API key is missing
2025-10-10T01:26:12.253Z [[32minfo[39m] [OpenRouter] Default model: x-ai/grok-4-fast

stdout | tests/unit/lib/openrouter-client.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

 ✓ tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > applies custom temperature and penalties 14ms
 × tests/unit/lib/openrouter-client.test.ts > OpenRouter Client > throws error when API key is missing 8ms
   → expected [Function] to throw error including 'OpenRouter client not initialized' but got 'Cannot read properties of undefined (…'
stdout | tests/unit/server/advanced-content-generator.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/unit/server/advanced-content-generator.test.ts
[dotenv@17.2.2] injecting env (0) from .env -- tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/unit/server/advanced-content-generator.test.ts
2025-10-10T01:26:12.482Z [[33mwarn[39m] Preset variations file is empty, using built-in presets

stdout | tests/unit/server/advanced-content-generator.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

 ✓ tests/unit/server/advanced-content-generator.test.ts > advanced content generator helpers > selectWeightedUniqueFragments favors higher weighted fragments 0ms
 ✓ tests/unit/server/advanced-content-generator.test.ts > advanced content generator helpers > wraps custom prompts with contextual connectors 4ms
 ✓ tests/unit/server/advanced-content-generator.test.ts > applyHumanization > respects the configured maxQuirks limit 0ms
 ✓ tests/unit/server/advanced-content-generator.test.ts > generateAdvancedContent - titles > produces varied title sets across repeated runs 5ms
 ✓ tests/unit/server/advanced-content-generator.test.ts > generateAdvancedContent - titles > surfaces a broad mix of individual titles over multiple runs 10ms
 ✓ tests/unit/server/advanced-content-generator.test.ts > generateAdvancedContent humanization > keeps appended hashtags intact after applying humanization 1ms
 ✓ tests/unit/server/advanced-content-generator.test.ts > generateAdvancedContent humanization > produces deterministic content when randomness is seeded 1ms
 ✓ tests/unit/server/advanced-content-generator.test.ts > generateAdvancedContent authenticity diagnostics > returns authenticity metrics with reddit voice markers 1ms
stdout | tests/unit/server/services/safety-systems.record-post.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }

stderr | tests/unit/server/services/safety-systems.record-post.test.ts
Error closing database connections: Error: [vitest] No "closeDatabaseConnections" export is defined on the "../../../../server/db.js" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///home/dave/CascadeProjects/TPilot/[39mnode_modules/[4mvitest[24m/dist/chunks/execute.B7h3T_Hc.js:284:17[90m)[39m
    at Object.closeDatabaseConnections [as get] [90m(file:///home/dave/CascadeProjects/TPilot/[39mnode_modules/[4mvitest[24m/dist/chunks/execute.B7h3T_Hc.js:330:16[90m)[39m
    at closeDatabaseConnections [90m(/home/dave/CascadeProjects/TPilot/[39mtests/test-utils.ts:29:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at [90m/home/dave/CascadeProjects/TPilot/[39mtests/vitest-setup.ts:92:5 {
  codeFrame: [32m'vi\x1B[33m.\x1B[39m\x1B[34mmock\x1B[39m(\x1B[35mimport\x1B[39m(\x1B[32m"../../../../server/db.js"\x1B[39m)\x1B[33m,\x1B[39m \x1B[35masync\x1B[39m (importOriginal) \x1B[33m=>\x1B[39m {\n'[39m +
    [32m'  \x1B[35mconst\x1B[39m actual \x1B[33m=\x1B[39m \x1B[35mawait\x1B[39m \x1B[34mimportOriginal\x1B[39m()\n'[39m +
    [32m'  \x1B[35mreturn\x1B[39m {\n'[39m +
    [32m'    \x1B[33m...\x1B[39mactual\x1B[33m,\x1B[39m\n'[39m +
    [32m'    \x1B[90m// your mocked methods\x1B[39m\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

stderr | tests/unit/server/services/safety-systems.record-post.test.ts
Error during test cleanup: Error: [vitest] No "closeDatabaseConnections" export is defined on the "../../../../server/db.js" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///home/dave/CascadeProjects/TPilot/[39mnode_modules/[4mvitest[24m/dist/chunks/execute.B7h3T_Hc.js:284:17[90m)[39m
    at Object.closeDatabaseConnections [as get] [90m(file:///home/dave/CascadeProjects/TPilot/[39mnode_modules/[4mvitest[24m/dist/chunks/execute.B7h3T_Hc.js:330:16[90m)[39m
    at closeDatabaseConnections [90m(/home/dave/CascadeProjects/TPilot/[39mtests/test-utils.ts:29:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:95:5)[39m
    at [90m/home/dave/CascadeProjects/TPilot/[39mtests/vitest-setup.ts:92:5 {
  codeFrame: [32m'vi\x1B[33m.\x1B[39m\x1B[34mmock\x1B[39m(\x1B[35mimport\x1B[39m(\x1B[32m"../../../../server/db.js"\x1B[39m)\x1B[33m,\x1B[39m \x1B[35masync\x1B[39m (importOriginal) \x1B[33m=>\x1B[39m {\n'[39m +
    [32m'  \x1B[35mconst\x1B[39m actual \x1B[33m=\x1B[39m \x1B[35mawait\x1B[39m \x1B[34mimportOriginal\x1B[39m()\n'[39m +
    [32m'  \x1B[35mreturn\x1B[39m {\n'[39m +
    [32m'    \x1B[33m...\x1B[39mactual\x1B[33m,\x1B[39m\n'[39m +
    [32m'    \x1B[90m// your mocked methods\x1B[39m\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

 × tests/unit/server/services/safety-systems.record-post.test.ts > SafetyManager.recordPost > inserts a new rate limit row when no rows were updated 17ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
 × tests/unit/server/services/safety-systems.record-post.test.ts > SafetyManager.recordPost > increments existing rate limit row when update succeeds 1ms
   → Transform failed with 1 error:
/home/dave/CascadeProjects/TPilot/server/lib/config.ts:145:62: ERROR: Expected "}" but found ")"
stdout | tests/unit/server/advanced-content-generator.titles.test.ts
[dotenv@17.2.2] injecting env (0) from .env.test -- tip: 🔐 encrypt with Dotenvx: https://dotenvx.com

stdout | tests/unit/server/advanced-content-generator.titles.test.ts
[dotenv@17.2.2] injecting env (0) from .env -- tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/unit/server/advanced-content-generator.titles.test.ts
2025-10-10T01:26:12.630Z [[33mwarn[39m] Preset variations file is empty, using built-in presets

stdout | tests/unit/server/advanced-content-generator.titles.test.ts
⚠️  Open handles: [
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'PipeWrap'[39m, [32m'PipeWrap'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m,  [32m'Timeout'[39m,
  [32m'Timeout'[39m
]

