
> rest-express@1.0.0 dev
> NODE_ENV=development tsx --import=server/instrumentation.ts server/index.ts

2025-10-11T11:52:54.375Z [[32minfo[39m] Sentry DSN not configured, skipping Sentry initialization
[dotenv@17.2.2] injecting env (36) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
warn: ADMIN_PASSWORD_HASH environment variable is not set. Admin login is disabled. {"timestamp":"2025-10-11T11:52:55.004Z"}
warn: ADMIN_EMAIL environment variable is not set. Admin login is disabled. {"timestamp":"2025-10-11T11:52:55.005Z"}
2025-10-11T11:52:55.209Z [[32minfo[39m] [Gemini] Text model: gemini-2.5-flash
2025-10-11T11:52:55.209Z [[32minfo[39m] [Gemini] Vision model: gemini-2.5-flash
2025-10-11T11:52:55.210Z [[32minfo[39m] [OpenRouter] Default model: opengvlab/internvl3-78b
2025-10-11T11:52:55.424Z [[32minfo[39m] [HEALTH] Script executed directly, starting bootstrap...
2025-10-11T11:52:55.425Z [[32minfo[39m] [HEALTH] Starting application bootstrap...
2025-10-11T11:52:55.425Z [[32minfo[39m] [HEALTH] Environment: development
2025-10-11T11:52:55.425Z [[32minfo[39m] [HEALTH] Platform: linux
2025-10-11T11:52:55.425Z [[32minfo[39m] [HEALTH] Architecture: x64
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:52:55.442Z [[33mwarn[39m] Could not apply advanced rate limiting {"error":{"code":"ERR_MODULE_NOT_FOUND"}}
2025-10-11T11:52:55.446Z [[32minfo[39m] Observability middleware configured
2025-10-11T11:52:55.447Z [[32minfo[39m] Observability middleware applied
2025-10-11T11:52:55.448Z [[32minfo[39m] Session store configured with Redis backend
2025-10-11T11:52:55.449Z [[32minfo[39m] Setting up auth routes {"apiPrefix":"/api","signupRoute":"/api/auth/signup","loginRoute":"/api/auth/login"}
2025-10-11T11:52:55.487Z [[33mwarn[39m] Creating default admin account for development
2025-10-11T11:52:55.487Z [[33mwarn[39m] ‚ö†Ô∏è DEFAULT ADMIN CREDENTIALS:
2025-10-11T11:52:55.487Z [[33mwarn[39m]    Email: admin@localhost
2025-10-11T11:52:55.488Z [[33mwarn[39m]    Password: admin123456
2025-10-11T11:52:55.488Z [[33mwarn[39m]    CHANGE THESE IN PRODUCTION!
2025-10-11T11:52:55.490Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:52:55.492Z [[31merror[39m] Failed to create development admin account {"devErr":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\", \"avatar_url\", \"website\", \"timezone\", \"language\", \"two_factor_enabled\", \"last_login_at\", \"password_hash\", \"last_password_change\", \"posts_count\", \"captions_generated\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@localhost","admin",1],"cause":{}}}
2025-10-11T11:52:55.493Z [[32minfo[39m] üîß Applying production database fixes...
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:52:55.495Z [[31merror[39m] ‚ùå Failed to apply production fixes {"error":{"query":"select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\", \"avatar_url\", \"website\", \"timezone\", \"language\", \"two_factor_enabled\", \"last_login_at\", \"password_hash\", \"last_password_change\", \"posts_count\", \"captions_generated\" from \"users\" where (\"users\".\"email\" = $1 or \"users\".\"username\" = $2) limit $3","params":["admin@localhost","admin",1],"cause":{}}}
2025-10-11T11:52:55.497Z [[32minfo[39m] Initializing queue system...
2025-10-11T11:52:55.497Z [[31merror[39m] üîß Using PostgreSQL queue backend (Redis not available)
2025-10-11T11:52:55.498Z [[31merror[39m] üîß Initializing PostgreSQL Queue backend
2025-10-11T11:52:55.499Z [[32minfo[39m] Queue system initialized
2025-10-11T11:52:55.499Z [info] üîÑ Initializing background workers...
2025-10-11T11:52:55.500Z [info] ‚úÖ Post worker initialized with queue abstraction
2025-10-11T11:52:55.500Z [info] ‚úÖ Post worker initialized
2025-10-11T11:52:55.500Z [info] ‚úÖ Metrics worker initialized with queue abstraction
2025-10-11T11:52:55.500Z [info] ‚úÖ Metrics worker initialized
2025-10-11T11:52:55.500Z [info] ‚úÖ AI Promo worker initialized with queue abstraction
2025-10-11T11:52:55.500Z [info] ‚úÖ AI Promo worker initialized
2025-10-11T11:52:55.500Z [info] ‚úÖ Dunning worker initialized with queue abstraction
2025-10-11T11:52:55.500Z [info] ‚úÖ Dunning worker initialized
2025-10-11T11:52:55.500Z [info] ‚úÖ Batch posting worker initialized with queue abstraction
2025-10-11T11:52:55.500Z [info] ‚úÖ Batch posting worker initialized
2025-10-11T11:52:55.500Z [info] ‚è≠Ô∏è Community sync worker skipped - Reddit service credentials not configured
2025-10-11T11:52:55.500Z [info] ‚úÖ Community sync worker initialized
2025-10-11T11:52:55.502Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
2025-10-11T11:52:55.504Z [[31merror[39m] üîç Starting queue monitoring...
2025-10-11T11:52:55.508Z [[31merror[39m] Failed to collect metrics for queue post-queue: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: post-queue,pending {"query":"select count(*) from \"queue_jobs\" where (\"queue_jobs\".\"queue_name\" = $1 and \"queue_jobs\".\"status\" = $2)","params":["post-queue","pending"],"cause":{}}
Error: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: post-queue,pending
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:152:18)
    at async PgQueue.getPendingCount (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:110:22)
    at async Promise.all (index 0)
    at async QueueMonitor.collectMetrics (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:85:52)
    at async QueueMonitor.startMonitoring (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:50:5)
    at async initializeWorkers (/home/dave/CascadeProjects/TPilot/server/lib/workers/index.ts:33:3)
    at async startQueue (/home/dave/CascadeProjects/TPilot/server/bootstrap/queue.ts:16:5)
    at async createApp (/home/dave/CascadeProjects/TPilot/server/app.ts:359:7)
    at async bootstrap (/home/dave/CascadeProjects/TPilot/server/index.ts:49:24)
2025-10-11T11:52:55.510Z [[31merror[39m] Failed to collect metrics for queue batch-post-queue: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: batch-post-queue,pending {"query":"select count(*) from \"queue_jobs\" where (\"queue_jobs\".\"queue_name\" = $1 and \"queue_jobs\".\"status\" = $2)","params":["batch-post-queue","pending"],"cause":{}}
Error: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: batch-post-queue,pending
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:152:18)
    at async PgQueue.getPendingCount (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:110:22)
    at async Promise.all (index 0)
    at async QueueMonitor.collectMetrics (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:85:52)
    at async QueueMonitor.startMonitoring (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:50:5)
    at async initializeWorkers (/home/dave/CascadeProjects/TPilot/server/lib/workers/index.ts:33:3)
    at async startQueue (/home/dave/CascadeProjects/TPilot/server/bootstrap/queue.ts:16:5)
    at async createApp (/home/dave/CascadeProjects/TPilot/server/app.ts:359:7)
    at async bootstrap (/home/dave/CascadeProjects/TPilot/server/index.ts:49:24)
2025-10-11T11:52:55.512Z [[31merror[39m] Failed to collect metrics for queue metrics-queue: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: metrics-queue,pending {"query":"select count(*) from \"queue_jobs\" where (\"queue_jobs\".\"queue_name\" = $1 and \"queue_jobs\".\"status\" = $2)","params":["metrics-queue","pending"],"cause":{}}
Error: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: metrics-queue,pending
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:152:18)
    at async PgQueue.getPendingCount (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:110:22)
    at async Promise.all (index 0)
    at async QueueMonitor.collectMetrics (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:85:52)
    at async QueueMonitor.startMonitoring (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:50:5)
    at async initializeWorkers (/home/dave/CascadeProjects/TPilot/server/lib/workers/index.ts:33:3)
    at async startQueue (/home/dave/CascadeProjects/TPilot/server/bootstrap/queue.ts:16:5)
    at async createApp (/home/dave/CascadeProjects/TPilot/server/app.ts:359:7)
    at async bootstrap (/home/dave/CascadeProjects/TPilot/server/index.ts:49:24)
2025-10-11T11:52:55.514Z [[31merror[39m] Failed to collect metrics for queue ai-promo-queue: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: ai-promo-queue,pending {"query":"select count(*) from \"queue_jobs\" where (\"queue_jobs\".\"queue_name\" = $1 and \"queue_jobs\".\"status\" = $2)","params":["ai-promo-queue","pending"],"cause":{}}
Error: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: ai-promo-queue,pending
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:152:18)
    at async PgQueue.getPendingCount (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:110:22)
    at async Promise.all (index 0)
    at async QueueMonitor.collectMetrics (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:85:52)
    at async QueueMonitor.startMonitoring (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:50:5)
    at async initializeWorkers (/home/dave/CascadeProjects/TPilot/server/lib/workers/index.ts:33:3)
    at async startQueue (/home/dave/CascadeProjects/TPilot/server/bootstrap/queue.ts:16:5)
    at async createApp (/home/dave/CascadeProjects/TPilot/server/app.ts:359:7)
    at async bootstrap (/home/dave/CascadeProjects/TPilot/server/index.ts:49:24)
2025-10-11T11:52:55.515Z [[31merror[39m] Failed to collect metrics for queue dunning-queue: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: dunning-queue,pending {"query":"select count(*) from \"queue_jobs\" where (\"queue_jobs\".\"queue_name\" = $1 and \"queue_jobs\".\"status\" = $2)","params":["dunning-queue","pending"],"cause":{}}
Error: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: dunning-queue,pending
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:152:18)
    at async PgQueue.getPendingCount (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:110:22)
    at async Promise.all (index 0)
    at async QueueMonitor.collectMetrics (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:85:52)
    at async QueueMonitor.startMonitoring (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:50:5)
    at async initializeWorkers (/home/dave/CascadeProjects/TPilot/server/lib/workers/index.ts:33:3)
    at async startQueue (/home/dave/CascadeProjects/TPilot/server/bootstrap/queue.ts:16:5)
    at async createApp (/home/dave/CascadeProjects/TPilot/server/app.ts:359:7)
    at async bootstrap (/home/dave/CascadeProjects/TPilot/server/index.ts:49:24)
2025-10-11T11:52:55.517Z [[31merror[39m] Failed to collect metrics for queue community-sync-queue: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: community-sync-queue,pending {"query":"select count(*) from \"queue_jobs\" where (\"queue_jobs\".\"queue_name\" = $1 and \"queue_jobs\".\"status\" = $2)","params":["community-sync-queue","pending"],"cause":{}}
Error: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: community-sync-queue,pending
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:152:18)
    at async PgQueue.getPendingCount (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:110:22)
    at async Promise.all (index 0)
    at async QueueMonitor.collectMetrics (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:85:52)
    at async QueueMonitor.startMonitoring (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:50:5)
    at async initializeWorkers (/home/dave/CascadeProjects/TPilot/server/lib/workers/index.ts:33:3)
    at async startQueue (/home/dave/CascadeProjects/TPilot/server/bootstrap/queue.ts:16:5)
    at async createApp (/home/dave/CascadeProjects/TPilot/server/app.ts:359:7)
    at async bootstrap (/home/dave/CascadeProjects/TPilot/server/index.ts:49:24)
2025-10-11T11:52:55.518Z [[31merror[39m] ‚úÖ Queue monitoring started (interval: 30000ms)
2025-10-11T11:52:55.518Z [info] üöÄ Queue monitoring started
2025-10-11T11:52:55.518Z [[32minfo[39m] Background workers initialized
2025-10-11T11:52:55.518Z [[32minfo[39m] üöÄ Starting cron job manager...
2025-10-11T11:52:55.534Z [[32minfo[39m] ‚úÖ Started cron job: process-scheduled-posts (* * * * *)
2025-10-11T11:52:55.537Z [[32minfo[39m] ‚úÖ Started cron job: cleanup-old-posts (0 3 * * *)
2025-10-11T11:52:55.539Z [[32minfo[39m] ‚úÖ Started cron job: update-analytics (0 * * * *)
2025-10-11T11:52:55.541Z [[32minfo[39m] ‚úÖ Started cron job: check-stuck-jobs (*/5 * * * *)
2025-10-11T11:52:55.545Z [[32minfo[39m] ‚úÖ Started cron job: sync-reddit-communities (0 2 * * 1)
2025-10-11T11:52:55.548Z [[32minfo[39m] ‚úÖ Started cron job: database-backup (0 4 * * *)
2025-10-11T11:52:55.548Z [[32minfo[39m] ‚úÖ Cron job manager started successfully
2025-10-11T11:52:55.548Z [[32minfo[39m] Cron manager started
2025-10-11T11:52:55.549Z [[32minfo[39m] Queue monitoring started (interval: 30000ms)
2025-10-11T11:52:55.549Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
info: üìà Starting worker auto-scaling... {"timestamp":"2025-10-11T11:52:55.551Z"}
info: ‚úÖ Worker auto-scaling started (interval: 60000ms) {"timestamp":"2025-10-11T11:52:55.552Z"}
2025-10-11T11:52:55.552Z [[32minfo[39m] Worker auto-scaling started (interval: 60000ms)
2025-10-11T11:52:55.554Z [[33mwarn[39m] Environment configuration issue detected: SENTRY_DSN: Invalid url
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:52:55.650Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:52:55.697Z [[34mdebug[39m] Client build candidate missing index at /home/dave/CascadeProjects/dist/client/index.html
2025-10-11T11:52:55.698Z [[34mdebug[39m] Client build candidate missing index at /home/dave/CascadeProjects/client/dist/index.html
2025-10-11T11:52:55.698Z [[32minfo[39m] Serving client from: /home/dave/CascadeProjects/TPilot/client
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:52:55.801Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:52:56.002Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:52:56.048Z [[32minfo[39m] Vite development server configured
2025-10-11T11:52:56.049Z [[32minfo[39m] [HEALTH] Express app created successfully in 624ms
2025-10-11T11:52:56.049Z [[32minfo[39m] [HEALTH] Target port from environment: 3005
2025-10-11T11:52:56.049Z [[32minfo[39m] [HEALTH] Starting server on 0.0.0.0:3005
2025-10-11T11:52:56.050Z [[32minfo[39m] [HEALTH] ‚úÖ Server started successfully on port 3005 in 625ms
2025-10-11T11:52:56.050Z [[32minfo[39m] serving on port 3005
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:52:56.269Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:52:56.571Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:52:56.925Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:52:57.328Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:52:57.504Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:52:57.778Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:52:58.281Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:52:58.832Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:52:59.435Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:52:59.507Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
2025-10-11T11:53:00.006Z [[34mdebug[39m] ‚è∞ Running cron job: process-scheduled-posts
2025-10-11T11:53:00.008Z [[31merror[39m] ‚ùå Failed to process scheduled posts {"error":"Failed query: select \"id\", \"user_id\", \"title\", \"content\", \"image_url\", \"caption\", \"subreddit\", \"scheduled_for\", \"timezone\", \"status\", \"nsfw\", \"spoiler\", \"flair_id\", \"flair_text\", \"reddit_post_id\", \"reddit_post_url\", \"error_message\", \"executed_at\", \"cancelled_at\", \"media_urls\", \"send_replies\", \"created_at\", \"updated_at\" from \"scheduled_posts\" where (\"scheduled_posts\".\"scheduled_for\" <= $1 and \"scheduled_posts\".\"status\" = $2) limit $3\nparams: 2025-10-11T11:53:00.006Z,pending,10"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:00.087Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:00.790Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:01.510Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:01.540Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:02.342Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:03.193Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:03.512Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:04.094Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:05.045Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:05.514Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:06.045Z [[31merror[39m] Redis session store error {"error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:06.269Z [[32minfo[39m] Request received {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","method":"POST","path":"/api/auth/login","query":{},"ip":"127.0.0.1","userAgent":"curl/8.5.0"}
2025-10-11T11:53:06.277Z [[33mwarn[39m] Input validation failed {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","source":"body","path":"/api/auth/login","method":"POST","errors":{"email":["Invalid email"]},"formErrors":[],"ip":"127.0.0.1","userAgent":"curl/8.5.0"}
2025-10-11T11:53:06.278Z [[32minfo[39m] Response sent {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","statusCode":400,"duration":9,"method":"POST","path":"/api/auth/login"}
{"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","date":"Sat Oct 11 2025 06:53:06 GMT-0500 (Central Daylight Time)","error":{"code":"ERR_HTTP_HEADERS_SENT"},"exception":true,"level":"error","message":"uncaughtException: Cannot set headers after they are sent to the client\nError [ERR_HTTP_HEADERS_SENT]: Cannot set headers after they are sent to the client\n    at ServerResponse.setHeader (node:_http_outgoing:655:11)\n    at ServerResponse.<anonymous> (/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts:112:9)\n    at ServerResponse.emit (node:events:536:35)\n    at onFinish (node:_http_outgoing:1031:10)\n    at callback (node:internal/streams/writable:766:21)\n    at afterWrite (node:internal/streams/writable:710:5)\n    at afterWriteTick (node:internal/streams/writable:696:10)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)","os":{"loadavg":[1.43,1.57,1.3],"uptime":260908.19},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/server/index.ts"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":532689,"external":6605778,"heapTotal":167735296,"heapUsed":129700648,"rss":413810688},"pid":1810950,"uid":1000,"version":"v20.19.5"},"stack":"Error [ERR_HTTP_HEADERS_SENT]: Cannot set headers after they are sent to the client\n    at ServerResponse.setHeader (node:_http_outgoing:655:11)\n    at ServerResponse.<anonymous> (/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts:112:9)\n    at ServerResponse.emit (node:events:536:35)\n    at onFinish (node:_http_outgoing:1031:10)\n    at callback (node:internal/streams/writable:766:21)\n    at afterWrite (node:internal/streams/writable:710:5)\n    at afterWriteTick (node:internal/streams/writable:696:10)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)","timestamp":"2025-10-11T11:53:06.281Z","trace":[{"column":11,"file":"node:_http_outgoing","function":"ServerResponse.setHeader","line":655,"method":"setHeader","native":false},{"column":9,"file":"/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts","function":null,"line":112,"method":null,"native":false},{"column":35,"file":"node:events","function":"ServerResponse.emit","line":536,"method":"emit","native":false},{"column":10,"file":"node:_http_outgoing","function":"onFinish","line":1031,"method":null,"native":false},{"column":21,"file":"node:internal/streams/writable","function":"callback","line":766,"method":null,"native":false},{"column":5,"file":"node:internal/streams/writable","function":"afterWrite","line":710,"method":null,"native":false},{"column":10,"file":"node:internal/streams/writable","function":"afterWriteTick","line":696,"method":null,"native":false},{"column":21,"file":"node:internal/process/task_queues","function":"process.processTicksAndRejections","line":81,"method":"processTicksAndRejections","native":false}]}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:07.096Z [[31merror[39m] Redis session store error {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:07.516Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:08.199Z [[31merror[39m] Redis session store error {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:09.352Z [[31merror[39m] Redis session store error {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:09.518Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:10.554Z [[31merror[39m] Redis session store error {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:11.531Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:11.806Z [[31merror[39m] Redis session store error {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:13.108Z [[31merror[39m] Redis session store error {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:13.540Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:14.459Z [[31merror[39m] Redis session store error {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:15.545Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:15.859Z [[31merror[39m] Redis session store error {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:17.310Z [[31merror[39m] Redis session store error {"correlationId":"f24630ec-dd21-4d4a-bf2b-cfbf6030e581","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:17.340Z [[32minfo[39m] Request received {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","method":"POST","path":"/api/auth/login","query":{},"ip":"127.0.0.1","userAgent":"curl/8.5.0"}
error: Storage operation failed - getting user by username: {"error":"Failed query: select \"id\", \"username\", \"password\", \"email\", \"role\", \"is_admin\", \"email_verified\", \"first_name\", \"last_name\", \"tier\", \"must_change_password\", \"subscription_status\", \"trial_ends_at\", \"provider\", \"provider_id\", \"avatar\", \"bio\", \"referral_code_id\", \"referred_by\", \"reddit_username\", \"reddit_access_token\", \"reddit_refresh_token\", \"reddit_id\", \"stripe_customer_id\", \"stripe_subscription_id\", \"banned_at\", \"suspended_until\", \"ban_reason\", \"suspension_reason\", \"created_at\", \"updated_at\", \"last_login\", \"password_reset_at\", \"deleted_at\", \"is_deleted\", \"avatar_url\", \"website\", \"timezone\", \"language\", \"two_factor_enabled\", \"last_login_at\", \"password_hash\", \"last_password_change\", \"posts_count\", \"captions_generated\" from \"users\" where (\"users\".\"username\" = $1 and \"users\".\"is_deleted\" = $2) limit $3\nparams: admin,false,1","timestamp":"2025-10-11T11:53:17.344Z"}
2025-10-11T11:53:17.344Z [[32minfo[39m] Response sent {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","statusCode":401,"duration":4,"method":"POST","path":"/api/auth/login"}
{"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","date":"Sat Oct 11 2025 06:53:17 GMT-0500 (Central Daylight Time)","error":{"code":"ERR_HTTP_HEADERS_SENT"},"exception":true,"level":"error","message":"uncaughtException: Cannot set headers after they are sent to the client\nError [ERR_HTTP_HEADERS_SENT]: Cannot set headers after they are sent to the client\n    at ServerResponse.setHeader (node:_http_outgoing:655:11)\n    at ServerResponse.<anonymous> (/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts:112:9)\n    at ServerResponse.emit (node:events:536:35)\n    at onFinish (node:_http_outgoing:1031:10)\n    at callback (node:internal/streams/writable:766:21)\n    at afterWrite (node:internal/streams/writable:710:5)\n    at afterWriteTick (node:internal/streams/writable:696:10)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)","os":{"loadavg":[2.34,1.77,1.36],"uptime":260919.25},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/server/index.ts"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":445396,"external":6529640,"heapTotal":113651712,"heapUsed":110191960,"rss":252174336},"pid":1810950,"uid":1000,"version":"v20.19.5"},"stack":"Error [ERR_HTTP_HEADERS_SENT]: Cannot set headers after they are sent to the client\n    at ServerResponse.setHeader (node:_http_outgoing:655:11)\n    at ServerResponse.<anonymous> (/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts:112:9)\n    at ServerResponse.emit (node:events:536:35)\n    at onFinish (node:_http_outgoing:1031:10)\n    at callback (node:internal/streams/writable:766:21)\n    at afterWrite (node:internal/streams/writable:710:5)\n    at afterWriteTick (node:internal/streams/writable:696:10)\n    at process.processTicksAndRejections (node:internal/process/task_queues:81:21)","timestamp":"2025-10-11T11:53:17.345Z","trace":[{"column":11,"file":"node:_http_outgoing","function":"ServerResponse.setHeader","line":655,"method":"setHeader","native":false},{"column":9,"file":"/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts","function":null,"line":112,"method":null,"native":false},{"column":35,"file":"node:events","function":"ServerResponse.emit","line":536,"method":"emit","native":false},{"column":10,"file":"node:_http_outgoing","function":"onFinish","line":1031,"method":null,"native":false},{"column":21,"file":"node:internal/streams/writable","function":"callback","line":766,"method":null,"native":false},{"column":5,"file":"node:internal/streams/writable","function":"afterWrite","line":710,"method":null,"native":false},{"column":10,"file":"node:internal/streams/writable","function":"afterWriteTick","line":696,"method":null,"native":false},{"column":21,"file":"node:internal/process/task_queues","function":"process.processTicksAndRejections","line":81,"method":"processTicksAndRejections","native":false}]}
2025-10-11T11:53:17.547Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:18.810Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:19.549Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:20.361Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:21.557Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:21.966Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:23.564Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:23.617Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:25.318Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:25.519Z [[31merror[39m] Failed to collect metrics for queue post-queue: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: post-queue,pending {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"select count(*) from \"queue_jobs\" where (\"queue_jobs\".\"queue_name\" = $1 and \"queue_jobs\".\"status\" = $2)","params":["post-queue","pending"],"cause":{}}
Error: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: post-queue,pending
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:152:18)
    at async PgQueue.getPendingCount (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:110:22)
    at async Promise.all (index 0)
    at async QueueMonitor.collectMetrics (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:85:52)
    at async Timeout._onTimeout (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:55:9)
2025-10-11T11:53:25.520Z [[31merror[39m] Failed to collect metrics for queue batch-post-queue: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: batch-post-queue,pending {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"select count(*) from \"queue_jobs\" where (\"queue_jobs\".\"queue_name\" = $1 and \"queue_jobs\".\"status\" = $2)","params":["batch-post-queue","pending"],"cause":{}}
Error: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: batch-post-queue,pending
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:152:18)
    at async PgQueue.getPendingCount (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:110:22)
    at async Promise.all (index 0)
    at async QueueMonitor.collectMetrics (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:85:52)
    at async Timeout._onTimeout (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:55:9)
2025-10-11T11:53:25.522Z [[31merror[39m] Failed to collect metrics for queue metrics-queue: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: metrics-queue,pending {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"select count(*) from \"queue_jobs\" where (\"queue_jobs\".\"queue_name\" = $1 and \"queue_jobs\".\"status\" = $2)","params":["metrics-queue","pending"],"cause":{}}
Error: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: metrics-queue,pending
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:152:18)
    at async PgQueue.getPendingCount (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:110:22)
    at async Promise.all (index 0)
    at async QueueMonitor.collectMetrics (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:85:52)
    at async Timeout._onTimeout (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:55:9)
2025-10-11T11:53:25.524Z [[31merror[39m] Failed to collect metrics for queue ai-promo-queue: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: ai-promo-queue,pending {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"select count(*) from \"queue_jobs\" where (\"queue_jobs\".\"queue_name\" = $1 and \"queue_jobs\".\"status\" = $2)","params":["ai-promo-queue","pending"],"cause":{}}
Error: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: ai-promo-queue,pending
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:152:18)
    at async PgQueue.getPendingCount (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:110:22)
    at async Promise.all (index 0)
    at async QueueMonitor.collectMetrics (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:85:52)
    at async Timeout._onTimeout (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:55:9)
2025-10-11T11:53:25.525Z [[31merror[39m] Failed to collect metrics for queue dunning-queue: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: dunning-queue,pending {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"select count(*) from \"queue_jobs\" where (\"queue_jobs\".\"queue_name\" = $1 and \"queue_jobs\".\"status\" = $2)","params":["dunning-queue","pending"],"cause":{}}
Error: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: dunning-queue,pending
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:152:18)
    at async PgQueue.getPendingCount (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:110:22)
    at async Promise.all (index 0)
    at async QueueMonitor.collectMetrics (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:85:52)
    at async Timeout._onTimeout (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:55:9)
2025-10-11T11:53:25.527Z [[31merror[39m] Failed to collect metrics for queue community-sync-queue: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: community-sync-queue,pending {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"select count(*) from \"queue_jobs\" where (\"queue_jobs\".\"queue_name\" = $1 and \"queue_jobs\".\"status\" = $2)","params":["community-sync-queue","pending"],"cause":{}}
Error: Failed query: select count(*) from "queue_jobs" where ("queue_jobs"."queue_name" = $1 and "queue_jobs"."status" = $2)
params: community-sync-queue,pending
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:152:18)
    at async PgQueue.getPendingCount (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:110:22)
    at async Promise.all (index 0)
    at async QueueMonitor.collectMetrics (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:85:52)
    at async Timeout._onTimeout (/home/dave/CascadeProjects/TPilot/server/lib/queue-monitor.ts:55:9)
2025-10-11T11:53:25.566Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:27.068Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:27.567Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:28.869Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:29.570Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:30.720Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:31.572Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:32.621Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:33.576Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:34.571Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:35.580Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:36.574Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:37.583Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:38.576Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:39.586Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:40.577Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:41.592Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:42.579Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:43.593Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:44.580Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:45.595Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:46.582Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:47.598Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:48.583Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:49.599Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:50.584Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:51.601Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:52.585Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:53.604Z [[31merror[39m] Error in queue polling: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","query":"update \"queue_jobs\" set \"status\" = $1 where (\"queue_jobs\".\"status\" = $2 and delay_until <= now())","params":["pending","delayed"],"cause":{}}
Error: Failed query: update "queue_jobs" set "status" = $1 where ("queue_jobs"."status" = $2 and delay_until <= now())
params: pending,delayed
    at NeonPreparedQuery.queryWithCache (/home/dave/CascadeProjects/TPilot/node_modules/src/pg-core/session.ts:73:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/dave/CascadeProjects/TPilot/node_modules/src/neon-serverless/session.ts:147:11)
    at async PgQueue.processDelayedJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:152:5)
    at async PgQueue.pollForJobs (/home/dave/CascadeProjects/TPilot/server/lib/queue-pg.ts:135:7)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
[ioredis] Unhandled error event: Error: connect ECONNREFUSED 127.0.0.1:6379
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)
2025-10-11T11:53:54.586Z [[31merror[39m] Redis session store error {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"connect ECONNREFUSED 127.0.0.1:6379"}
2025-10-11T11:53:55.450Z [[31merror[39m] unhandledRejection: require is not defined
ReferenceError: require is not defined
    at collectHealthMetrics (/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts:134:28)
    at Timeout._onTimeout (/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts:157:27)
    at listOnTimeout (node:internal/timers:581:17)
    at process.processTimers (node:internal/timers:519:7) {"error":{},"rejection":true,"date":"Sat Oct 11 2025 06:53:55 GMT-0500 (Central Daylight Time)","process":{"pid":1810950,"uid":1000,"gid":1000,"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","version":"v20.19.5","argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/server/index.ts"],"memoryUsage":{"rss":251592704,"heapTotal":114438144,"heapUsed":111039160,"external":6527415,"arrayBuffers":455702}},"os":{"loadavg":[2.11,1.79,1.39],"uptime":260957.35},"trace":[{"column":28,"file":"/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts","function":"collectHealthMetrics","line":134,"method":null,"native":false},{"column":27,"file":"/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts","function":"Timeout._onTimeout","line":157,"method":"_onTimeout","native":false},{"column":17,"file":"node:internal/timers","function":"listOnTimeout","line":581,"method":null,"native":false},{"column":7,"file":"node:internal/timers","function":"process.processTimers","line":519,"method":"processTimers","native":false}],"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6"}
ReferenceError: require is not defined
    at collectHealthMetrics (/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts:134:28)
    at Timeout._onTimeout (/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts:157:27)
    at listOnTimeout (node:internal/timers:581:17)
    at process.processTimers (node:internal/timers:519:7)
{"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","date":"Sat Oct 11 2025 06:53:55 GMT-0500 (Central Daylight Time)","error":{},"level":"error","message":"unhandledRejection: require is not defined\nReferenceError: require is not defined\n    at collectHealthMetrics (/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts:134:28)\n    at Timeout._onTimeout (/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts:157:27)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)","os":{"loadavg":[2.11,1.79,1.39],"uptime":260957.35},"process":{"argv":["/usr/bin/node","/home/dave/CascadeProjects/TPilot/server/index.ts"],"cwd":"/home/dave/CascadeProjects/TPilot","execPath":"/usr/bin/node","gid":1000,"memoryUsage":{"arrayBuffers":455702,"external":6527415,"heapTotal":114438144,"heapUsed":111039160,"rss":251592704},"pid":1810950,"uid":1000,"version":"v20.19.5"},"rejection":true,"stack":"ReferenceError: require is not defined\n    at collectHealthMetrics (/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts:134:28)\n    at Timeout._onTimeout (/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts:157:27)\n    at listOnTimeout (node:internal/timers:581:17)\n    at process.processTimers (node:internal/timers:519:7)","timestamp":"2025-10-11T11:53:55.450Z","trace":[{"column":28,"file":"/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts","function":"collectHealthMetrics","line":134,"method":null,"native":false},{"column":27,"file":"/home/dave/CascadeProjects/TPilot/server/middleware/observability.ts","function":"Timeout._onTimeout","line":157,"method":"_onTimeout","native":false},{"column":17,"file":"node:internal/timers","function":"listOnTimeout","line":581,"method":null,"native":false},{"column":7,"file":"node:internal/timers","function":"process.processTimers","line":519,"method":"processTimers","native":false}]}
2025-10-11T11:53:55.452Z [[31merror[39m] Unhandled rejection {"correlationId":"97b1f645-a698-46a2-b255-30e8042a10a6","error":"require is not defined"}
