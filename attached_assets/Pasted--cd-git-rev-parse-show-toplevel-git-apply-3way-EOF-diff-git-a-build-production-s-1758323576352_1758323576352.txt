 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/build-production.sh b/build-production.sh
index f5e4338ac2a9a74a3ba8a6f9b4851487bd1bc3a7..50acee395756c56a2c30f8f627123632e71b39a8 100644
--- a/build-production.sh
+++ b/build-production.sh
@@ -1,41 +1,59 @@
 #!/bin/bash
-set -e
+set -euo pipefail
+
+LOG_DIR="logs"
+TS_SERVER_FILE_LOG="$LOG_DIR/tsc-server-files.log"
+
+mkdir -p "$LOG_DIR"
 
 echo "ðŸ”¨ Building ThottoPilot for production..."
 
 # Clean previous builds
 echo "ðŸ“¦ Cleaning previous builds..."
 rm -rf dist
 
 echo "ðŸ“‚ Creating dist directory structure..."
 mkdir -p dist/server
 
 echo "âš™ï¸ Compiling server TypeScript..."
 echo "Current directory: $(pwd)"
 echo "TSConfig file exists: $(test -f tsconfig.server.json && echo 'yes' || echo 'no')"
-npx tsc -p tsconfig.server.json --listFiles | head -3
+echo "ðŸ“„ Saving TypeScript file list to $TS_SERVER_FILE_LOG"
+npx tsc -p tsconfig.server.json --listFiles > "$TS_SERVER_FILE_LOG"
+if [ -s "$TS_SERVER_FILE_LOG" ]; then
+  echo "First TypeScript files included in build:"
+  head -n 3 "$TS_SERVER_FILE_LOG" | sed 's/^/  /'
+  line_count=$(wc -l < "$TS_SERVER_FILE_LOG")
+  if [ "$line_count" -gt 3 ]; then
+    echo "  ... (full list written to $TS_SERVER_FILE_LOG)"
+  else
+    echo "  (complete list above)"
+  fi
+else
+  echo "âš ï¸ No TypeScript files listed; check $TS_SERVER_FILE_LOG for details."
+fi
 echo "Compilation finished, checking output..."
 
 # Check if the compiled server file exists
 if [ ! -f dist/server/index.js ]; then
   echo "âŒ Server build failed: dist/server/index.js missing"
   echo "Checking build output..."
   ls -la dist/server/ || echo "No dist/server directory found"
   if [ -d dist/server ]; then
     echo "Contents of dist/server:"
     find dist/server -name "*.js" -type f | head -10
   fi
   echo "TypeScript compilation may have failed or output to wrong directory"
   exit 1
 fi
 
 chmod +x dist/server/index.js
 echo "âœ… Set executable permissions on dist/server/index.js"
 echo "âœ… Server TypeScript compiled to dist/"
 
 # Apply path mappings
 echo "ðŸ”— Resolving path mappings..."
 tsc-alias -p tsconfig.server.json
 
 # Fix imports - add .js extensions
 echo "ðŸ”„ Fixing import extensions..."
 
EOF
)