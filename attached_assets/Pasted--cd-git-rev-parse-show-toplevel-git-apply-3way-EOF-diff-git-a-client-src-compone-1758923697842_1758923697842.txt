 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/client/src/components/enhanced-ai-generator.tsx b/client/src/components/enhanced-ai-generator.tsx
index 0824776885f7f0954c281de4697cd31135a429b5..3d93d80d164b1f9a6b14b834ddec4ac277540dc8 100644
--- a/client/src/components/enhanced-ai-generator.tsx
+++ b/client/src/components/enhanced-ai-generator.tsx
@@ -1,125 +1,135 @@
 import React, { useState } from "react";
 import { useMutation, useQueryClient } from "@tanstack/react-query";
 import { useAuth } from "@/hooks/useAuth";
 import { useToast } from "@/hooks/use-toast";
 import { Button } from "@/components/ui/button";
 import { Label } from "@/components/ui/label";
 import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
 import { Badge } from "@/components/ui/badge";
 import { Textarea } from "@/components/ui/textarea";
+import { AuthModal } from "@/components/auth-modal";
 import { apiRequest, type ApiError } from "@/lib/queryClient";
 import type { ContentGeneration } from "@shared/schema";
-import { Sparkles, Brain, RefreshCw, Settings, Copy, Hash } from "lucide-react";
+import { Sparkles, Brain, RefreshCw, Copy, Hash, Lock } from "lucide-react";
 
 // Define types for mutation variables and response
 interface GenerateContentVariables {
   platform?: string;
   style?: string;
   theme?: string;
   subreddit?: string;
   customPrompt?: string;
   prompt?: string;
   includePromotion?: boolean;
   allowsPromotion?: "none" | "subtle" | "direct";
 }
 
 // Assuming GeneratedContent is defined elsewhere and matches the structure of UnifiedAIResponse or similar
 interface GeneratedContent {
   titles?: string[] | string;
   content?: string;
   photoInstructions?:
     | {
         lighting: string;
         cameraAngle: string;
         composition: string;
         styling: string;
         mood: string;
         technicalSettings: string;
       }
     | string;
   hashtags?: string[];
   caption?: string;
   id?: number;
   userId?: number;
   platform?: string;
   style?: string;
   theme?: string;
   prompt?: string;
   subreddit?: string;
   allowsPromotion?: boolean;
   generationType?: string;
   createdAt?: Date | string;
 }
 
+const isApiError = (error: unknown): error is ApiError => {
+  return typeof error === "object" && error !== null && "status" in error && "statusText" in error;
+};
+
 const photoInstructionFields: Array<{ key: keyof ContentGeneration["photoInstructions"]; label: string }> = [
   { key: "lighting", label: "Lighting" },
   { key: "cameraAngle", label: "Camera Angle" },
   { key: "composition", label: "Composition" },
   { key: "styling", label: "Styling" },
   { key: "mood", label: "Mood" },
   { key: "technicalSettings", label: "Technical Settings" }
 ];
 
 const photoTypes = [
   { id: 'selfie', label: 'Selfie', description: 'Casual self-portrait' },
   { id: 'portrait', label: 'Portrait', description: 'Professional headshot' },
   { id: 'lifestyle', label: 'Lifestyle', description: 'Daily activity shots' },
   { id: 'artistic', label: 'Artistic', description: 'Creative composition' },
 ];
 
 const toneOptions = [
   { value: "confident", label: "Confident" },
   { value: "flirty", label: "Flirty" },
   { value: "playful", label: "Playful" },
   { value: "mysterious", label: "Mysterious" },
   { value: "friendly", label: "Friendly" },
 ];
 
 interface EnhancedAIGeneratorProps {
   onContentGenerated: (content: ContentGeneration) => void;
   userTier?: string;
   canGenerate?: boolean;
 }
 
 export function EnhancedAIGenerator({
   onContentGenerated,
   userTier = "guest",
   canGenerate = true
 }: EnhancedAIGeneratorProps) {
   const { isAuthenticated } = useAuth();
   const { toast } = useToast();
   const queryClient = useQueryClient();
 
   // Form state
   const [photoType, setPhotoType] = useState<string>("selfie");
   const [tone, setTone] = useState<string>("confident");
   const [customPrompt, setCustomPrompt] = useState<string>("");
   const [generatedContent, setGeneratedContent] = useState<GeneratedContent | null>(null);
   const [copiedItem, setCopiedItem] = useState<string | null>(null);
+  const [showAuthModal, setShowAuthModal] = useState(false);
+
+  const isGuestMode = !isAuthenticated || userTier === "guest";
 
-  const isGuestMode = !isAuthenticated || userTier === 'guest';
+  const openAuthModal = () => {
+    setShowAuthModal(true);
+  };
 
   const tierConfig = {
     guest: {
       dailyLimit: 3,
       color: 'bg-gradient-to-br from-orange-50 to-amber-100 hover:from-orange-100 hover:to-amber-200 text-orange-900 border-2 border-orange-200 hover:border-orange-300 shadow-sm hover:shadow-md'
     },
     free: {
       dailyLimit: 10,
       color: 'bg-gradient-to-br from-orange-50 to-amber-100 hover:from-orange-100 hover:to-amber-200 text-orange-900 border-2 border-orange-200 hover:border-orange-300 shadow-sm hover:shadow-md'
     },
     pro: {
       dailyLimit: 100,
       color: 'bg-gradient-to-br from-orange-50 to-amber-100 hover:from-orange-100 hover:to-amber-200 text-orange-900 border-2 border-orange-200 hover:border-orange-300 shadow-sm hover:shadow-md'
     }
   };
 
   const currentTierConfig = tierConfig[userTier as keyof typeof tierConfig] || tierConfig.guest;
 
   const basePhotoInstructions: ContentGeneration["photoInstructions"] = {
     lighting: "Soft natural lighting",
     cameraAngle: "Eye-level framing",
     composition: "Balanced composition highlighting the subject",
     styling: "Signature outfit and accessories",
     mood: "Confident and inviting",
     technicalSettings: "Auto settings"
diff --git a/client/src/components/enhanced-ai-generator.tsx b/client/src/components/enhanced-ai-generator.tsx
index 0824776885f7f0954c281de4697cd31135a429b5..3d93d80d164b1f9a6b14b834ddec4ac277540dc8 100644
--- a/client/src/components/enhanced-ai-generator.tsx
+++ b/client/src/components/enhanced-ai-generator.tsx
@@ -163,51 +173,51 @@ export function EnhancedAIGenerator({
       return {
         ...basePhotoInstructions,
         composition: instructions,
         mood: instructions
       };
     }
 
     return basePhotoInstructions;
   };
 
   const normalizeTitles = (titles: unknown): string[] => {
     if (Array.isArray(titles)) {
       const filtered = titles.filter((title): title is string => typeof title === "string" && title.trim().length > 0);
       if (filtered.length > 0) {
         return filtered;
       }
     }
 
     if (typeof titles === "string" && titles.trim().length > 0) {
       return [titles];
     }
 
     return ["Generated content ready to share"];
   };
 
-  const generateContentMutation = useMutation<GeneratedContent, Error, GenerateContentVariables>({
+  const generateContentMutation = useMutation<GeneratedContent, ApiError | Error, GenerateContentVariables>({
     mutationFn: async (data) => {
       const effectivePrompt = data.customPrompt || data.prompt || "";
       const response = await apiRequest("POST", "/api/generate-unified", {
         mode: "text",
         platform: data.platform || "reddit",
         style: data.style || "confident",
         theme: data.theme || "general",
         prompt: effectivePrompt,
         customInstructions: effectivePrompt,
         includePromotion:
           typeof data.includePromotion === "boolean"
             ? data.includePromotion
             : data.allowsPromotion !== "none"
       });
       return (await response.json()) as GeneratedContent;
     },
     onSuccess: (data, variables) => {
       setGeneratedContent(data);
 
       const candidate = data as Record<string, unknown>;
       const normalizedTitles = normalizeTitles(candidate.titles ?? data.titles);
       const normalizedPhotoInstructions = normalizePhotoInstructions(data.photoInstructions);
       const rawId = candidate.id;
       const id = typeof rawId === "number" ? rawId : Date.now();
       const rawUserId = candidate.userId;
diff --git a/client/src/components/enhanced-ai-generator.tsx b/client/src/components/enhanced-ai-generator.tsx
index 0824776885f7f0954c281de4697cd31135a429b5..3d93d80d164b1f9a6b14b834ddec4ac277540dc8 100644
--- a/client/src/components/enhanced-ai-generator.tsx
+++ b/client/src/components/enhanced-ai-generator.tsx
@@ -259,60 +269,83 @@ export function EnhancedAIGenerator({
       const structuredGeneration: ContentGeneration = {
         id,
         userId,
         platform: resolvedPlatform,
         style: resolvedStyle,
         theme: resolvedTheme,
         titles: normalizedTitles,
         content: contentText,
         photoInstructions: normalizedPhotoInstructions,
         prompt: resolvedPrompt || null,
         subreddit: resolvedSubreddit || null,
         allowsPromotion: resolvedAllowsPromotion,
         generationType,
         createdAt
       };
 
       onContentGenerated(structuredGeneration);
 
       toast({
         title: "Content Generated Successfully!",
         description: structuredGeneration.titles[0] || "Your AI content is ready."
       });
 
       queryClient.invalidateQueries({ queryKey: ["/api/stats"] });
     },
-    onError: (error: Error) => {
+    onError: (error) => {
+      let toastTitle = "Generation Failed";
+      let description = "Failed to generate content. Please try again.";
+
+      if (isApiError(error)) {
+        if (error.isAuthError) {
+          toastTitle = "Sign in to generate content";
+          description =
+            error.userMessage ?? "Please log in or create an account to continue generating AI content.";
+          openAuthModal();
+        } else {
+          description = error.userMessage ?? error.message;
+        }
+      } else if (error instanceof Error) {
+        description = error.message;
+      }
+
       toast({
-        title: "Generation Failed",
-        description: error.message || "Failed to generate content. Please try again.",
+        title: toastTitle,
+        description,
         variant: "destructive",
       });
     },
   });
 
+  const isGenerateDisabled = isGuestMode || generateContentMutation.isPending;
+
   const handleGenerate = () => {
+    if (isGuestMode) {
+      openAuthModal();
+      return;
+    }
+
     generateContentMutation.mutate({
       platform: "reddit",
       style: tone,
       theme: photoType,
       customPrompt: customPrompt.trim() || undefined,
     });
   };
 
   const copyToClipboard = async (text: string, type: string) => {
     try {
       await navigator.clipboard.writeText(text);
       setCopiedItem(type);
       toast({
         title: `${type} copied!`,
         description: "Content copied to clipboard",
       });
       setTimeout(() => setCopiedItem(null), 2000);
     } catch (_error) {
       toast({
         title: "Copy failed",
         description: "Unable to copy to clipboard",
         variant: "destructive",
       });
     }
   };
diff --git a/client/src/components/enhanced-ai-generator.tsx b/client/src/components/enhanced-ai-generator.tsx
index 0824776885f7f0954c281de4697cd31135a429b5..3d93d80d164b1f9a6b14b834ddec4ac277540dc8 100644
--- a/client/src/components/enhanced-ai-generator.tsx
+++ b/client/src/components/enhanced-ai-generator.tsx
@@ -372,68 +405,81 @@ export function EnhancedAIGenerator({
                       <div className="text-xs opacity-80">{type.description}</div>
                     </div>
                   </Button>
                 ))}
               </div>
             </div>
 
             <div className="space-y-2">
               <Label className="text-base font-medium text-amber-600">Text Tone</Label>
               <Select value={tone} onValueChange={setTone}>
                 <SelectTrigger className="border-amber-200 focus:ring-amber-500">
                   <SelectValue placeholder="Select tone" />
                 </SelectTrigger>
                 <SelectContent>
                   {toneOptions.map((option) => (
                     <SelectItem key={option.value} value={option.value}>
                       {option.label}
                     </SelectItem>
                   ))}
                 </SelectContent>
               </Select>
             </div>
           </div>
         </div>
 
-        <Button
-          onClick={handleGenerate}
-          disabled={generateContentMutation.isPending}
-          className="w-full bg-gradient-to-r from-orange-500 via-amber-500 to-red-500 hover:from-orange-600 hover:via-amber-500 hover:to-red-500 text-white font-medium"
-          size="lg"
-        >
-          {generateContentMutation.isPending ? (
-            <>
-              <RefreshCw className="mr-2 h-4 w-4 animate-spin" />
-              Generating...
-            </>
-          ) : (
-            <>
-              <Sparkles className="mr-2 h-4 w-4" />
-              Generate Content
-            </>
+        <div className="space-y-3">
+          <Button
+            onClick={handleGenerate}
+            disabled={isGenerateDisabled}
+            className="w-full bg-gradient-to-r from-orange-500 via-amber-500 to-red-500 hover:from-orange-600 hover:via-amber-500 hover:to-red-500 text-white font-medium disabled:opacity-70"
+            size="lg"
+          >
+            {generateContentMutation.isPending ? (
+              <>
+                <RefreshCw className="mr-2 h-4 w-4 animate-spin" />
+                Generating...
+              </>
+            ) : (
+              <>
+                <Sparkles className="mr-2 h-4 w-4" />
+                Generate Content
+              </>
+            )}
+          </Button>
+
+          {isGuestMode && (
+            <Button
+              variant="outline"
+              onClick={openAuthModal}
+              className="w-full border-orange-300 text-orange-800 hover:bg-orange-100"
+            >
+              <Lock className="mr-2 h-4 w-4" />
+              Sign in to unlock AI generation
+            </Button>
           )}
-        </Button>
+        </div>
 
         {generatedContent && (
           <div className="space-y-4 p-4 bg-gradient-to-br from-orange-50 via-amber-50 to-rose-100 rounded-lg border border-orange-200">
             <h4 className="font-semibold text-lg text-orange-800 flex items-center gap-2">
               <Sparkles className="h-4 w-4 text-orange-500" />
               Generated Content
             </h4>
 
             {generatedContent.titles && Array.isArray(generatedContent.titles) && generatedContent.titles.length > 0 && (
               <div className="space-y-2">
                 <Label className="text-sm font-medium text-orange-700">Titles:</Label>
                 {generatedContent.titles.map((title, index) => (
                   <div key={`${title}-${index}`} className="relative p-3 bg-white rounded-lg border group">
                     <p className="text-sm font-medium pr-8">{title}</p>
                     <Button
                       variant="ghost"
                       size="sm"
                       onClick={() => copyToClipboard(title, "Title")}
                       className="absolute top-2 right-2 h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity text-orange-600"
                     >
                       <Copy className="h-3 w-3" />
                     </Button>
                   </div>
                 ))}
               </div>
diff --git a/client/src/components/enhanced-ai-generator.tsx b/client/src/components/enhanced-ai-generator.tsx
index 0824776885f7f0954c281de4697cd31135a429b5..3d93d80d164b1f9a6b14b834ddec4ac277540dc8 100644
--- a/client/src/components/enhanced-ai-generator.tsx
+++ b/client/src/components/enhanced-ai-generator.tsx
@@ -507,37 +553,55 @@ export function EnhancedAIGenerator({
                 <dl className="grid gap-2 text-sm text-slate-700 dark:text-slate-200">
                   {photoInstructionFields.map(({ key, label }) => (
                     <div key={key} className="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-1">
                       <dt className="font-semibold text-orange-700">{label}</dt>
                       <dd className="sm:text-right">{generatedContent.photoInstructions[key]}</dd>
                     </div>
                   ))}
                 </dl>
                 <Button
                   variant="ghost"
                   size="sm"
                   onClick={() =>
                     copyToClipboard(JSON.stringify(generatedContent.photoInstructions, null, 2), "Photo Instructions")
                   }
                   className="absolute top-2 right-2 h-7 px-2 text-xs opacity-70 hover:opacity-100 text-orange-600"
                 >
                   <Copy className="h-3 w-3 mr-1" />
                   Copy JSON
                 </Button>
               </div>
             </div>
           </div>
         )}
 
         {isGuestMode && (
-          <div className="text-center p-4 bg-orange-50 border border-orange-200 rounded-lg">
+          <div className="text-center p-4 bg-orange-50 border border-orange-200 rounded-lg space-y-3">
             <p className="text-sm text-orange-700">
-              <a href="/login" className="text-orange-800 underline ml-1 font-medium">
-                Sign up for full access
-              </a>
+              Create a free account to save presets, remove limits, and unlock every AI workflow.
             </p>
+            <Button
+              variant="secondary"
+              onClick={openAuthModal}
+              className="bg-white text-orange-800 hover:bg-orange-100 border border-orange-200"
+            >
+              <Lock className="mr-2 h-4 w-4" />
+              Sign up for full access
+            </Button>
           </div>
         )}
       </div>
+      <AuthModal
+        isOpen={showAuthModal}
+        onClose={() => setShowAuthModal(false)}
+        onSuccess={() => {
+          setShowAuthModal(false);
+          toast({
+            title: "🎉 Welcome back!",
+            description: "You can now generate enhanced AI content without limits.",
+          });
+        }}
+        initialMode="signup"
+      />
     </div>
   );
-}
+}
 
EOF
)