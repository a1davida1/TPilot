ent/src/components/__tests__/sample-upload.test.tsx
New
+275
-0

import React from "react";
import {
  describe,
  it,
  expect,
  beforeEach,
  afterEach,
  afterAll,
  vi,
} from "vitest";
import { createRoot } from "react-dom/client";
import type { Root } from "react-dom/client";
import { act } from "react-dom/test-utils";
import type { UploadResult } from "@uppy/core";

import SampleUpload from "@/components/sample-upload";

interface MutationOptions<Variables = unknown> {
  mutationFn: (variables: Variables) => Promise<unknown>;
  onSuccess?: () => void;
  onError?: (error: Error) => void;
}

type QueryResult<Data> = {
  data: Data;
  isLoading: boolean;
  error: Error | null;
};

const mockUseQuery = vi.fn();
const mockUseMutation = vi.fn();
const toastMock = vi.fn();
const invalidateQueriesMock = vi.fn();
const apiRequestMock = vi.fn();

vi.mock("@tanstack/react-query", () => ({
  useQuery: (options: { queryKey: unknown; queryFn: () => Promise<unknown> }) =>
    mockUseQuery(options),
  useMutation: (options: MutationOptions) => mockUseMutation(options),
}));

vi.mock("@/hooks/use-toast", () => ({
  useToast: () => ({ toast: toastMock }),
}));

vi.mock("@/lib/queryClient", async () => {
  const actual = await vi.importActual<typeof import("@/lib/queryClient")>("@/lib/queryClient");
  return {
    ...actual,
    apiRequest: apiRequestMock,
    queryClient: {
      ...actual.queryClient,
      invalidateQueries: invalidateQueriesMock,
    },
  };
});

vi.mock("@/components/ObjectUploader", () => ({
  ObjectUploader: ({
    onComplete,
    children,
  }: {
    onComplete?: (
      result: UploadResult<Record<string, unknown>, Record<string, unknown>>,
    ) => void;
    children: React.ReactNode;
  }) => (
    <button
      type="button"
      data-testid="mock-object-uploader"
      onClick={() =>
        onComplete?.({
          successful: [{ uploadURL: "https://cdn.example.com/uploaded.png" }],
        } as UploadResult<Record<string, unknown>, Record<string, unknown>>)
      }
    >
      {children}
    </button>
  ),
}));

interface RenderResult {
  container: HTMLElement;
}

const mountedRoots: Array<{ root: Root; container: HTMLElement }> = [];

function render(ui: React.ReactElement): RenderResult {
  const container = document.createElement("div");
  document.body.appendChild(container);
  const root = createRoot(container);
  act(() => {
    root.render(ui);
  });
  mountedRoots.push({ root, container });
  return { container };
}

function cleanup() {
  while (mountedRoots.length > 0) {
    const entry = mountedRoots.pop();
    if (!entry) {
      break;
    }
    const { root, container } = entry;
    act(() => {
      root.unmount();
    });
    container.remove();
  }
}

function textMatches(text: string, matcher: string | RegExp): boolean {
  if (typeof matcher === "string") {
    return text.includes(matcher);
  }
  return matcher.test(text);
}

function queryByText(matcher: string | RegExp): HTMLElement | null {
  const elements = Array.from(document.body.querySelectorAll("*") as NodeListOf<HTMLElement>);
  for (const element of elements) {
    const content = element.textContent?.trim() ?? "";
    if (content && textMatches(content, matcher)) {
      return element;
    }
  }
  return null;
}

function queryByTestId(testId: string): HTMLElement | null {
  return document.body.querySelector(`[data-testid="${testId}"]`) as HTMLElement | null;
}

async function waitFor<T>(callback: () => T, options: { timeout?: number; interval?: number } = {}): Promise<T> {
  const { timeout = 2000, interval = 20 } = options;
  const start = Date.now();
  let lastError: unknown;
  while (Date.now() - start < timeout) {
    try {
      return await callback();
    } catch (error) {
      lastError = error;
      await new Promise((resolve) => setTimeout(resolve, interval));
    }
  }
  throw lastError ?? new Error("waitFor timeout");
}

async function findByText(matcher: string | RegExp): Promise<HTMLElement> {
  return waitFor(() => {
    const element = queryByText(matcher);
    if (!element) {
      throw new Error("Text not found");
    }
    return element;
  });
}

async function findByTestId(testId: string): Promise<HTMLElement> {
  return waitFor(() => {
    const element = queryByTestId(testId);
    if (!element) {
      throw new Error("Test id not found");
    }
    return element;
  });
}

function getButtonByText(matcher: string | RegExp): HTMLButtonElement {
  const button = Array.from(document.body.querySelectorAll("button") as NodeListOf<HTMLButtonElement>).find((element) =>
    textMatches(element.textContent?.trim() ?? "", matcher),
  );
  if (!button) {
    throw new Error(`Button with text ${String(matcher)} not found`);
  }
  return button;
}

function click(element: HTMLElement) {
  act(() => {
    element.dispatchEvent(new MouseEvent("click", { bubbles: true, cancelable: true }));
  });
}

const clipboardDescriptor = Object.getOwnPropertyDescriptor(navigator, "clipboard");
const clipboardWriteMock = vi.fn<[], Promise<void>>();

describe("SampleUpload", () => {
  beforeEach(() => {
    cleanup();
    mockUseQuery.mockReset();
    mockUseMutation.mockReset();
    toastMock.mockReset();
    invalidateQueriesMock.mockReset();
    apiRequestMock.mockReset();
    clipboardWriteMock.mockReset();

    mockUseMutation.mockImplementation(() => ({ mutate: vi.fn(), isPending: false }));

    Object.defineProperty(navigator, "clipboard", {
      configurable: true,
      value: {
        writeText: clipboardWriteMock,
      },
    });
  });

  afterEach(() => {
    cleanup();
  });

  afterAll(() => {
    if (clipboardDescriptor) {
      Object.defineProperty(navigator, "clipboard", clipboardDescriptor);
    }
  });

  it("renders samples from the query and copies content to the clipboard", async () => {
    const sample = {
      id: 42,
      userId: 7,
      title: "Viral Reddit Post",
      content: "Always provide value first.",
      platform: "reddit" as const,
      createdAt: new Date("2024-06-01").toISOString(),
      updatedAt: new Date("2024-06-01").toISOString(),
      upvotes: 512,
    };

    mockUseQuery.mockImplementation((): QueryResult<typeof sample[]> => ({
      data: [sample],
      isLoading: false,
      error: null,
    }));

    render(<SampleUpload />);

    const sampleCard = await findByTestId(`sample-card-${sample.id}`);
    click(sampleCard);

    const copyButton = getButtonByText(/Copy Content/i);
    click(copyButton);

    await waitFor(() => {
      expect(clipboardWriteMock).toHaveBeenCalledWith(sample.content);
    });

    expect(toastMock).toHaveBeenCalledWith(
      expect.objectContaining({ title: "Copied!", description: "Content copied to clipboard." }),
    );
  });

  it("updates the form after an upload completes", async () => {
    mockUseQuery.mockImplementation((): QueryResult<[]> => ({
      data: [],
      isLoading: false,
      error: null,
    }));

    render(<SampleUpload />);

    const addButton = getButtonByText(/Add Sample/i);
    click(addButton);

    const uploaderButton = await findByTestId("mock-object-uploader");
    click(uploaderButton);

    await findByText(/Image uploaded successfully/i);

    expect(toastMock).toHaveBeenCalledWith(
      expect.objectContaining({ title: "Image uploaded" }),
    );
  });
});
client/src/components/sample-upload.tsx
+186
-90

import { useState, useEffect } from "react";
import { useMemo, useState } from "react";
import type { UploadResult } from "@uppy/core";
import { useQuery, useMutation } from "@tanstack/react-query";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Alert, AlertDescription, AlertTitle } from "@/components/ui/alert";
import { useToast } from "@/hooks/use-toast";
import { queryClient, apiRequest } from "@/lib/queryClient";
import { ObjectUploader } from "@/components/ObjectUploader";
import {
  Upload,
  Trash2,
  Plus,
  FileText,
  Calendar,
  Star,
  Copy,
  CheckCircle,
  AlertCircle
  AlertCircle,
} from "lucide-react";

type SamplePlatform = "reddit" | "twitter" | "instagram";

interface SamplePost {
  id: number;
  userId: number;
  title: string;
  content: string;
  platform: string;
  platform: SamplePlatform;
  subreddit?: string;
  upvotes?: number;
  imageUrl?: string;
  tags?: string[];
  createdAt: string;
  updatedAt: string;
}

interface SampleForm {
  title: string;
  content: string;
  platform: string;
  platform: SamplePlatform;
  subreddit: string;
  upvotes: number;
  imageUrl: string;
  tags: string[];
}

interface SamplePostResponse extends Omit<SamplePost, "platform" | "tags"> {
  platform?: string;
  tags?: unknown;
}

const EMPTY_FORM: SampleForm = {
  title: "",
  content: "",
  platform: "reddit",
  subreddit: "",
  upvotes: 0,
  imageUrl: "",
  tags: [],
};

function isSamplePlatform(value: unknown): value is SamplePlatform {
  return value === "reddit" || value === "twitter" || value === "instagram";
}

function normalizeSample(sample: SamplePostResponse): SamplePost {
  const tags = Array.isArray(sample.tags)
    ? sample.tags.filter((tag): tag is string => typeof tag === "string")
    : [];

  const platform = isSamplePlatform(sample.platform) ? sample.platform : "reddit";

  return {
    ...sample,
    tags,
    platform,
  };
}

export default function SampleUpload() {
  const { toast } = useToast();
  const [showAddForm, setShowAddForm] = useState(false);
  const [selectedSample, setSelectedSample] = useState<SamplePost | null>(null);
  const [formData, setFormData] = useState<SampleForm>({
    title: "",
    content: "",
    platform: "reddit",
    subreddit: "",
    upvotes: 0,
    imageUrl: "",
    tags: []
  });
  const [formData, setFormData] = useState<SampleForm>(EMPTY_FORM);
  const [formError, setFormError] = useState<string | null>(null);
  const [isCopying, setIsCopying] = useState(false);

  const fetchSamples = useMemo(
    () =>
      async (): Promise<SamplePost[]> => {
        const response = await apiRequest("GET", "/api/sample-posts");
        const payload = (await response.json()) as SamplePostResponse[];
        return payload.map(normalizeSample);
      },
    [],
  );

  const { data: samples = [], isLoading } = useQuery<SamplePost[]>({
    queryKey: ['/api/sample-posts'],
    retry: false
  const {
    data: samples = [],
    isLoading,
    error: queryError,
  } = useQuery<SamplePost[], Error>({
    queryKey: ["/api/sample-posts"],
    queryFn: fetchSamples,
    retry: false,
    staleTime: 60_000,
  });

  const deleteMutation = useMutation<void, Error, number>({
  const { mutate: deleteSample } = useMutation<unknown, Error, number>({
    mutationFn: async (id: number) => {
      await apiRequest('DELETE', `/api/sample-posts/${id}`);
      await apiRequest("DELETE", `/api/sample-posts/${id}`);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/sample-posts'] });
      void queryClient.invalidateQueries({ queryKey: ["/api/sample-posts"] });
      toast({
        title: "Sample deleted",
        description: "Sample post has been removed."
        description: "Sample post has been removed.",
      });
    },
    onError: () => {
    onError: (error) => {
      toast({
        title: "Error",
        variant: "destructive"
        title: "Unable to delete sample",
        description: error.message,
        variant: "destructive",
      });
    }
    },
  });

  const addMutation = useMutation<void, Error, SampleForm>({
  const addMutation = useMutation<unknown, Error, SampleForm>({
    mutationFn: async (data: SampleForm) => {
      await apiRequest('POST', '/api/sample-posts', data);
      await apiRequest("POST", "/api/sample-posts", data);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['/api/sample-posts'] });
      void queryClient.invalidateQueries({ queryKey: ["/api/sample-posts"] });
      toast({
        title: "Sample added",
        description: "Your sample post has been saved."
        description: "Your sample post has been saved.",
      });
      setShowAddForm(false);
      resetForm();
      setFormData(EMPTY_FORM);
      setFormError(null);
    },
    onError: () => {
    onError: (error) => {
      setFormError(error.message);
      toast({
        title: "Error",
        variant: "destructive"
        title: "Unable to add sample",
        description: error.message,
        variant: "destructive",
      });
    }
    },
  });

  const handleGetUploadParameters = async () => {
    const res = await apiRequest('POST', '/api/objects/upload');
    const { uploadURL } = (await res.json()) as { uploadURL: string };
    return { method: 'PUT' as const, url: uploadURL };
    const response = await apiRequest("POST", "/api/objects/upload");
    const { uploadURL } = (await response.json()) as { uploadURL: string };
    return { method: "PUT" as const, url: uploadURL };
  };

  interface UploadResult { successful?: Array<{ uploadURL?: string }> }
  const handleUploadComplete = (result: UploadResult) => {
    const uploadedUrl = result.successful?.[0]?.uploadURL;
    if (uploadedUrl) {
      setFormData((prev) => ({ ...prev, imageUrl: uploadedUrl }));
  const handleUploadComplete = (
    result: UploadResult<Record<string, unknown>, Record<string, unknown>>,
  ) => {
    const uploadedFile = result.successful?.find(
      (file): file is typeof file & { uploadURL: string } =>
        typeof file.uploadURL === "string" && file.uploadURL.length > 0,
    );

    if (uploadedFile) {
      setFormData((prev) => ({ ...prev, imageUrl: uploadedFile.uploadURL }));
      toast({
        title: "Image uploaded",
        description: "Your image has been uploaded successfully."
        description: "Your image has been uploaded successfully.",
      });
    }
  };

  const resetForm = () => {
    setFormData({
      title: "",
      content: "",
      platform: "reddit",
      subreddit: "",
      upvotes: 0,
      imageUrl: "",
      tags: []
  const handleNumberChange = (value: string) => {
    const parsed = Number.parseInt(value, 10);
    return Number.isNaN(parsed) ? 0 : parsed;
  };

  const ensurePlatform = (value: string): SamplePlatform =>
    isSamplePlatform(value) ? value : "reddit";

  const handleSubmit = (event: React.FormEvent<HTMLFormElement>) => {
    event.preventDefault();
    setFormError(null);
    addMutation.mutate({
      ...formData,
      platform: ensurePlatform(formData.platform),
      tags: Array.isArray(formData.tags) ? formData.tags : [],
    });
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    addMutation.mutate(formData);
  const handleCopyContent = async () => {
    if (!selectedSample) {
      return;
    }

    try {
      setIsCopying(true);
      if (typeof navigator === "undefined" || !navigator.clipboard?.writeText) {
        throw new Error("Clipboard is not available in this environment.");
      }
      await navigator.clipboard.writeText(selectedSample.content);
      toast({
        title: "Copied!",
        description: "Content copied to clipboard.",
      });
    } catch (error) {
      const message = error instanceof Error ? error.message : "Unable to copy content.";
      toast({
        title: "Copy failed",
        description: message,
        variant: "destructive",
      });
    } finally {
      setIsCopying(false);
    }
  };

  const queryErrorMessage = queryError?.message ?? "Unable to load sample posts.";

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
            Upload Sample Posts
          </h2>
          <p className="text-gray-400 mt-1">
            Upload your best performing posts to train the AI on your writing style
          </p>
        </div>
        <Button
          onClick={() => setShowAddForm(!showAddForm)}
          onClick={() => setShowAddForm((previous) => !previous)}
          className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700"
        >
          <Plus className="h-4 w-4 mr-2" />
          {showAddForm ? "Close" : "Add Sample"}
        </Button>
      </div>

      {showAddForm && (
        <Card className="bg-gray-900/50 border-gray-800/50 backdrop-blur-sm p-6">
          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label className="text-sm font-medium text-gray-300 block mb-2">
                Post Title
              </label>
              <input
                type="text"
                value={formData.title}
                onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                onChange={(event) => setFormData({ ...formData, title: event.target.value })}
                className="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                required
              />
            </div>

            <div>
              <label className="text-sm font-medium text-gray-300 block mb-2">
                Content
              </label>
              <textarea
                value={formData.content}
                onChange={(e) => setFormData({ ...formData, content: e.target.value })}
                onChange={(event) => setFormData({ ...formData, content: event.target.value })}
                className="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500 min-h-[150px]"
                required
              />
            </div>

            <div className="grid md:grid-cols-3 gap-4">
              <div>
                <label className="text-sm font-medium text-gray-300 block mb-2">
                  Platform
                </label>
                <select
                  value={formData.platform}
                  onChange={(e) => setFormData({ ...formData, platform: e.target.value })}
                  onChange={(event) =>
                    setFormData({ ...formData, platform: ensurePlatform(event.target.value) })
                  }
                  className="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                >
                  <option value="reddit">Reddit</option>
                  <option value="twitter">Twitter</option>
                  <option value="instagram">Instagram</option>
                </select>
              </div>

              <div>
                <label className="text-sm font-medium text-gray-300 block mb-2">
                  Subreddit (optional)
                </label>
                <input
                  type="text"
                  value={formData.subreddit}
                  onChange={(e) => setFormData({ ...formData, subreddit: e.target.value })}
                  onChange={(event) => setFormData({ ...formData, subreddit: event.target.value })}
                  className="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                />
              </div>

              <div>
                <label className="text-sm font-medium text-gray-300 block mb-2">
                  Upvotes/Likes
                </label>
                <input
                  type="number"
                  value={formData.upvotes}
                  onChange={(e) => setFormData({ ...formData, upvotes: parseInt(e.target.value) || 0 })}
                  onChange={(event) =>
                    setFormData({ ...formData, upvotes: handleNumberChange(event.target.value) })
                  }
                  className="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                />
              </div>
            </div>

            <div>
              <label className="text-sm font-medium text-gray-300 block mb-2">
                Upload Image (optional)
              </label>
              <ObjectUploader
                maxNumberOfFiles={1}
                maxFileSize={10485760}
                onGetUploadParameters={handleGetUploadParameters}
                onComplete={handleUploadComplete}
                buttonClassName="bg-gray-800/50 border border-gray-700 hover:bg-gray-700/50"
              >
                <Upload className="h-4 w-4 mr-2" />
                Upload Image
              </ObjectUploader>
              {formData.imageUrl && (
                <p className="text-sm text-green-400 mt-2">
                  <CheckCircle className="h-4 w-4 inline mr-1" />
                  Image uploaded successfully
                </p>
              )}
            </div>

            <div className="flex gap-3 pt-4">
              <Button
                type="submit"
                disabled={addMutation.isPending}
                className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700"
              >
                {addMutation.isPending ? "Adding..." : "Add Sample"}
              </Button>
              <Button
                type="button"
                variant="outline"
                onClick={() => {
                  setShowAddForm(false);
                  resetForm();
                  setFormData(EMPTY_FORM);
                  setFormError(null);
                }}
                className="border-gray-700 hover:bg-gray-800"
              >
                Cancel
              </Button>
            </div>

            {formError && (
              <Alert variant="destructive">
                <AlertCircle className="h-4 w-4" />
                <AlertTitle>Unable to save sample</AlertTitle>
                <AlertDescription>{formError}</AlertDescription>
              </Alert>
            )}
          </form>
        </Card>
      )}

      {isLoading ? (
        <div className="text-center py-12">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
        </div>
      ) : queryError ? (
        <Alert variant="destructive">
          <AlertCircle className="h-4 w-4" />
          <AlertTitle>Unable to load samples</AlertTitle>
          <AlertDescription>{queryErrorMessage}</AlertDescription>
        </Alert>
      ) : samples.length === 0 ? (
        <Card className="bg-gray-900/50 border-gray-800/50 backdrop-blur-sm p-12 text-center">
          <FileText className="h-16 w-16 text-gray-600 mx-auto mb-4" />
          <p className="text-gray-500 mb-6">
            Upload your best performing posts to help the AI learn your writing style
          </p>
          <Button
            onClick={() => setShowAddForm(true)}
            className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700"
          >
            <Plus className="h-4 w-4 mr-2" />
            Add Your First Sample
          </Button>
        </Card>
      ) : (
        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {samples.map((sample) => (
            <Card
              key={sample.id}
              data-testid={`sample-card-${sample.id}`}
              className="bg-gray-900/50 border-gray-800/50 backdrop-blur-sm p-6 hover:border-purple-700/50 transition-all cursor-pointer"
              onClick={() => setSelectedSample(sample)}
            >
              <div className="flex justify-between items-start mb-4">
                <h3 className="text-lg font-semibold text-white line-clamp-1">
                  {sample.title}
                </h3>
                <h3 className="text-lg font-semibold text-white line-clamp-1">{sample.title}</h3>
                <Button
                  size="sm"
                  variant="ghost"
                  onClick={(e) => {
                    e.stopPropagation();
                    deleteMutation.mutate(sample.id);
                  onClick={(event) => {
                    event.stopPropagation();
                    deleteSample(sample.id);
                  }}
                  className="text-red-400 hover:text-red-300 hover:bg-red-900/20"
                >
                  <Trash2 className="h-4 w-4" />
                </Button>
              </div>

              <p className="text-gray-400 text-sm line-clamp-3 mb-4">
                {sample.content}
              </p>
              <p className="text-gray-400 text-sm line-clamp-3 mb-4">{sample.content}</p>

              <div className="flex items-center gap-4 text-sm text-gray-500">
                <span className="flex items-center gap-1">
                  <Calendar className="h-3 w-3" />
                  {new Date(sample.createdAt).toLocaleDateString()}
                </span>
                {sample.upvotes && sample.upvotes > 0 && (
                {typeof sample.upvotes === "number" && sample.upvotes > 0 && (
                  <span className="flex items-center gap-1 text-green-400">
                    <Star className="h-3 w-3" />
                    {sample.upvotes}
                  </span>
                )}
                <Badge variant="secondary" className="bg-purple-900/30 text-purple-300">
                  {sample.platform}
                </Badge>
              </div>

              {sample.imageUrl && (
                <div className="mt-4">
                  <img
                    src={sample.imageUrl}
                    alt={sample.title}
                    className="w-full h-32 object-cover rounded-lg"
                  />
                </div>
              )}
            </Card>
          ))}
        </div>
      )}

      {selectedSample && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={() => setSelectedSample(null)}
        >
          <Card
            className="bg-gray-900 border-gray-800 max-w-2xl w-full max-h-[90vh] overflow-y-auto"
            onClick={(e) => e.stopPropagation()}
            onClick={(event) => event.stopPropagation()}
          >
            <div className="p-6">
              <div className="flex justify-between items-start mb-4">
                <h3 className="text-2xl font-bold text-white">
                  {selectedSample.title}
                </h3>
                <h3 className="text-2xl font-bold text-white">{selectedSample.title}</h3>
                <Button
                  size="sm"
                  variant="ghost"
                  onClick={() => setSelectedSample(null)}
                  className="text-gray-400 hover:text-white"
                >
                  ×
                </Button>
              </div>

              {selectedSample?.imageUrl && (
              {selectedSample.imageUrl && (
                <img
                  src={selectedSample.imageUrl}
                  alt={selectedSample.title}
                  className="w-full max-h-96 object-contain rounded-lg mb-6"
                />
              )}

              <div className="prose prose-invert max-w-none">
                <p className="whitespace-pre-wrap text-gray-300">
                  {selectedSample.content}
                </p>
                <p className="whitespace-pre-wrap text-gray-300">{selectedSample.content}</p>
              </div>

              <div className="mt-6 flex items-center gap-4 text-sm text-gray-500">
                <Badge variant="secondary" className="bg-purple-900/30 text-purple-300">
                  {selectedSample?.platform}
                  {selectedSample.platform}
                </Badge>
                {selectedSample?.upvotes && selectedSample.upvotes > 0 && (
                {typeof selectedSample.upvotes === "number" && selectedSample.upvotes > 0 && (
                  <span className="flex items-center gap-1 text-green-400">
                    <Star className="h-3 w-3" />
                    {selectedSample.upvotes}
                  </span>
                )}
                <span className="flex items-center gap-1">
                  <Calendar className="h-3 w-3" />
                  {new Date(selectedSample.createdAt).toLocaleDateString()}
                </span>
              </div>

              <div className="mt-6 flex gap-3">
                <Button
                  onClick={() => {
                    toast({
                      title: "Copied!",
                      description: "Content copied to clipboard."
                    });
                  }}
                  onClick={handleCopyContent}
                  disabled={isCopying}
                  className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700"
                >
                  <Copy className="h-4 w-4 mr-2" />
                  Copy Content
                  {isCopying ? "Copying..." : "Copy Content"}
                </Button>
              </div>
            </div>
          </Card>
        </div>
      )}
    </div>
  );
}
}